---
title: "Experiments 4 and 5 analysis script"
author: "Juliana E Trach"
date: "`r Sys.Date()`"
output: html_document
---
\newpage
# Abstract
Analysis code for Experiments 4-5 of "Structured action preparation during visuomotor decision-making." This script loads in data from usable participants in each experiment, concatenates all data frames, and runs main analyses. 


\newpage
```{r, echo=F, message=F, warning=F, error=T, fig.width=6, fig.height=4, fig.align='center'}
# set up workspace  
rm(list=ls(all=TRUE))
# set WD where data is
setwd("~/Documents/GitHub/StructuredActionPrepVMDM")
datadir = "~/Documents/GitHub/StructuredActionPrepVMDM/compiledData/"
# load libraries
library(ggplot2)
library(gridExtra)
library(MBESS)
library(ggpubr)
library(reshape2)
library(dplyr)
library(tidyr)
library(tidyverse)
library(itsadug)
library(RColorBrewer)
library(knitr)
library(extrafont)
library(fs)
library(fabricatr)
library(Rmisc)
library(lme4)
library(lmerTest)
library(rstatix)
library(MuMIn)
library(effsize)
####### READ IN RL DATA FOR EACH TASK #########

# set up the column order for all data frames
#colOrder = c('rt',	'subject',	'prolificID',	'trialType',	'key_press',	'corrresp',	'phase',	'stimNum',	'trialNum',	'corr',	'hierarchy',	'corrrespAll',	'finger_press',	'iter',	'zscoredRTs',	'logRTs',	'hand',	'couplet',	'handSwitch',	'coupletSwitch',	'fingerSwitch',	'handSwitch_actual',	'coupletSwitch_actual',	'fingerSwitch_actual',	'respHand',	'respCouplet',	'corrHand',	'corrCouplet',	'combinedType',	'treeDistance', 'includeStrict',	'include_25secondhalf',	'fingerDistance',	'corrrespAll_prev',	'finger_press_prev',	'nFeatureSwitch',	'topType',	'midType',	'lowType',	'rt_corrected_both',	'rt_corrected', 'rt_corrected_both_z', 'streak', 'expt', 'struct')
## HierDyn ##
# learnData
hierDyn = read_csv(file = 'compiledData/Experiment5_learn.csv')
hierDyn <- hierDyn[ -c(1) ]

# fix subnums and add expt info
hierDyn$subject = paste(hierDyn$subject,'hier',sep = '_')
hierDyn$expt = 'hierDyn'
hierDyn$struct = 'hier'
zscored = hierDyn%>% group_by(subject) %>% dplyr::summarize(z = scale(rt_corrected_both))
hierDyn$rt_corrected_both_z = zscored$z

hierDyn_forced = read_csv(file = 'compiledData/Experiment5_forced.csv')
hierDyn_forced <- hierDyn_forced[ -c(1) ]

hierDyn_forced$subject = paste(hierDyn_forced$subject,'hier',sep = '_')
hierDyn_forced$expt = 'hierDyn'
hierDyn_forced$struct = 'hier'

subjNums_hierDyn = unique(hierDyn$subject)

## FlatDyn ##
#learnData
flatDyn = read_csv(file = 'compiledData/Experiment6_learn.csv')
flatDyn <- flatDyn[ -c(1) ]
flatDyn$subject = paste(flatDyn$subject,'flat',sep = '_')
flatDyn$expt = 'flatDyn'
flatDyn$struct = 'flat'
#fill columns that should be filled
flatDyn$rt_corrected_both_z = NA
zscored = flatDyn%>% group_by(subject) %>% dplyr::summarize(z = scale(rt_corrected_both))
flatDyn$rt_corrected_both_z = zscored$z

flatDyn_forced = read_csv(file = 'compiledData/Experiment6_forced.csv')
flatDyn_forced <- flatDyn_forced[ -c(1) ]
flatDyn_forced$subject = paste(flatDyn_forced$subject,'flat',sep = '_')
flatDyn_forced$expt = 'flatDyn'
flatDyn_forced$struct = 'flat'

subjNums_flatDyn = unique(flatDyn$subject)


# bind the data frames together
compiledData = rbind(hierDyn, flatDyn)
compiledData_forced = rbind(hierDyn_forced,flatDyn_forced)
# add a finger_press_prev column for forced
compiledData_forced$finger_press_prev = NA
compiledData_forced$finger_press_prev[2:length(compiledData_forced$finger_press_prev)] = compiledData_forced$resp[1:length(compiledData_forced$finger_press_prev)-1]
compiledData_forced$finger_press_prev[compiledData_forced$trialNum == 1] = NA

compiledData_forced$corr_prev = NA
compiledData_forced$corr_prev[2:length(compiledData_forced$corr_prev)] = compiledData_forced$corr[1:length(compiledData_forced$corr_prev)-1]
compiledData_forced$corr_prev[compiledData_forced$trialNum == 1] = NA

# add transition type column
compiledData$transitionType = NA
typeCounter = 0
for(ai in 1:max(compiledData$finger_press_prev, na.rm = TRUE)){
  for(bi in ai:max(compiledData$resp, na.rm = TRUE)){
    typeCounter = typeCounter+1
    compiledData$transitionType[compiledData$finger_press_prev == ai & compiledData$resp == bi] = typeCounter
    compiledData$transitionType[compiledData$finger_press_prev == bi & compiledData$resp == ai] = typeCounter
  }
  }
compiledData$transitionType[compiledData$trialNum == 1] = NA

# add transition type column
compiledData_forced$transitionType = NA
typeCounter = 0
for(ai in 1:max(compiledData_forced$finger_press_prev, na.rm = TRUE)){
  for(bi in ai:max(compiledData_forced$resp, na.rm = TRUE)){
    typeCounter = typeCounter+1
    compiledData_forced$transitionType[compiledData_forced$finger_press_prev == ai & compiledData_forced$resp == bi] = typeCounter
    compiledData_forced$transitionType[compiledData_forced$finger_press_prev == bi & compiledData_forced$resp == ai] = typeCounter
  }
  }
compiledData_forced$transitionType[compiledData_forced$trialNum == 1] = NA

# add some comlumns to LEARNDATA
compiledData = compiledData %>% filter(iter < 56)
compiledData$treeDistance = as.factor(compiledData$treeDistance)
compiledData$nFeatureSwitch = as.factor(compiledData$nFeatureSwitch)
compiledData$fingerDistance = as.factor(compiledData$fingerDistance)

compiledData$corrHand_factor = as.factor(compiledData$corrHand)
compiledData$corrCouplet_factor = as.factor(compiledData$corrCouplet)
compiledData$corrFinger = NA
compiledData$errorType = NA
compiledData$errorType2 = NA


compiledData$corrFinger[compiledData$resp %in% c(1,3,5,7) & compiledData$corrresp %in% c(1,3,5,7)] = 1
compiledData$corrFinger[compiledData$resp %in% c(1,3,5,7) & compiledData$corrresp %in% c(2,4,6,8)] = 0
compiledData$corrFinger[compiledData$resp %in% c(2,4,6,8) & compiledData$corrresp %in% c(2,4,6,8)] = 1
compiledData$corrFinger[compiledData$resp %in% c(2,4,6,8) & compiledData$corrresp %in% c(1,3,5,7)] = 0

compiledData$errorType[compiledData$corrHand == 1 & compiledData$corrCouplet == 1 & compiledData$corr == 0] = '1/1/0'
compiledData$errorType[compiledData$corrHand == 1 & compiledData$corrCouplet == 1 & compiledData$corr == 1] = '1/1/1'
compiledData$errorType[compiledData$corrHand == 0 & compiledData$corrCouplet == 1] = '0/1/0'
compiledData$errorType[compiledData$corrHand == 0 & compiledData$corrCouplet == 0] = '0/0/0'


# add some columns to FORCED DATA
compiledData_forced$treeDistance_factor = as.factor(compiledData_forced$treeDistance)
compiledData_forced$nFeatureSwitch_factor = as.factor(compiledData_forced$nFeatureSwitch)
compiledData_forced$errorType = as.factor(compiledData_forced$errorType)
compiledData_forced$errorType2 = as.factor(compiledData_forced$errorType2)

compiledData_forced$corrHand_factor = as.factor(compiledData_forced$corrHand)
compiledData_forced$corrCouplet_factor = as.factor(compiledData_forced$corrCouplet)
compiledData_forced$corrFinger_factor = as.factor(compiledData_forced$corrFinger)

compiledData_forced$eml3 = NA
compiledData_forced$eml3[compiledData_forced$PT_actual <= .3] = 'a_early1'
compiledData_forced$eml3[compiledData_forced$PT_actual  > .3 & compiledData_forced$PT_actual <= .5] = 'a_early2'
compiledData_forced$eml3[compiledData_forced$PT_actual > .5 & compiledData_forced$PT_actual <= .7] = 'b_mid1'
compiledData_forced$eml3[compiledData_forced$PT_actual > .7 & compiledData_forced$PT_actual <= .9] = 'b_mid2'
compiledData_forced$eml3[compiledData_forced$PT_actual > .9& compiledData_forced$PT_actual <= 1.1] = 'c_late1'
compiledData_forced$eml3[compiledData_forced$PT_actual > 1.1] = 'c_late2'

compiledData_forced$errorDiff = NA
compiledData_forced$errorDiff = abs(compiledData_forced$corrresp-compiledData_forced$resp)

compiledData_forced$errorLevel = NA # hand/couplet/finger error based on cogsci description hand = 0/1/1;0/1/0;0/0/1;0/0/0 || couplet = 1/0/1;1/0/0 || finger = 1/1/0
compiledData_forced$errorLevel[compiledData_forced$errorType2 %in% c('1/1/0')] = 'bbottom'
compiledData_forced$errorLevel[compiledData_forced$errorType2 %in% c('1/0/1','1/0/0')] = 'cmid'
compiledData_forced$errorLevel[compiledData_forced$errorType2 %in% c('0/1/1','0/1/0','0/0/1','0/0/0')] = 'dtop'
compiledData_forced$errorLevel[compiledData_forced$errorType2 %in% c('1/1/1')] = 'acorr'

compiledData_forced$resp_dist = NA
compiledData_forced$resp_dist = abs(compiledData_forced$resp - compiledData_forced$finger_press_prev)

# add the UP information (i.e. relative to the previous response)
compiledData_forced$errorType2_up = NA
compiledData_forced$sameHand_up = NA
compiledData_forced$sameCouplet_up = NA
compiledData_forced$sameFinger_up = NA

compiledData_forced$sameHand_up[compiledData_forced$finger_press_prev %in% c(1,2,3,4) & compiledData_forced$resp %in% c(1,2,3,4)] = 1
compiledData_forced$sameHand_up[compiledData_forced$finger_press_prev %in% c(1,2,3,4) & compiledData_forced$resp %in% c(5,6,7,8)] = 0
compiledData_forced$sameHand_up[compiledData_forced$finger_press_prev %in% c(5,6,7,8) & compiledData_forced$resp %in% c(5,6,7,8)] = 1
compiledData_forced$sameHand_up[compiledData_forced$finger_press_prev %in% c(5,6,7,8) & compiledData_forced$resp %in% c(1,2,3,4)] = 0

compiledData_forced$sameCouplet_up[compiledData_forced$finger_press_prev %in% c(1,2,5,6) & compiledData_forced$resp %in% c(1,2,5,6)] = 1
compiledData_forced$sameCouplet_up[compiledData_forced$finger_press_prev %in% c(1,2,5,6) & compiledData_forced$resp %in% c(3,4,7,8)] = 0
compiledData_forced$sameCouplet_up[compiledData_forced$finger_press_prev %in% c(3,4,7,8) & compiledData_forced$resp %in% c(3,4,7,8)] = 1
compiledData_forced$sameCouplet_up[compiledData_forced$finger_press_prev %in% c(3,4,7,8) & compiledData_forced$resp %in% c(1,2,5,6)] = 0

compiledData_forced$sameFinger_up[compiledData_forced$finger_press_prev %in% c(1,3,5,7) & compiledData_forced$resp %in% c(1,3,5,7)] = 1
compiledData_forced$sameFinger_up[compiledData_forced$finger_press_prev %in% c(1,3,5,7) & compiledData_forced$resp %in% c(2,4,6,8)] = 0
compiledData_forced$sameFinger_up[compiledData_forced$finger_press_prev %in% c(2,4,6,8) & compiledData_forced$resp %in% c(2,4,6,8)] = 1
compiledData_forced$sameFinger_up[compiledData_forced$finger_press_prev %in% c(2,4,6,8) & compiledData_forced$resp %in% c(1,3,5,7)] = 0

compiledData_forced$errorType2_up[compiledData_forced$sameHand_up == 1 & compiledData_forced$sameCouplet_up == 1 & compiledData_forced$sameFinger_up == 1] = '1/1/1'
compiledData_forced$errorType2_up[compiledData_forced$sameHand_up == 1 & compiledData_forced$sameCouplet_up == 1 & compiledData_forced$sameFinger_up == 0] = '1/1/0'
compiledData_forced$errorType2_up[compiledData_forced$sameHand_up == 1 & compiledData_forced$sameCouplet_up == 0 & compiledData_forced$sameFinger_up == 1] = '1/0/1'
compiledData_forced$errorType2_up[compiledData_forced$sameHand_up == 1 & compiledData_forced$sameCouplet_up == 0 & compiledData_forced$sameFinger_up == 0] = '1/0/0'
compiledData_forced$errorType2_up[compiledData_forced$sameHand_up == 0 & compiledData_forced$sameCouplet_up == 1 & compiledData_forced$sameFinger_up == 1] = '0/1/1'
compiledData_forced$errorType2_up[compiledData_forced$sameHand_up == 0 & compiledData_forced$sameCouplet_up == 1 & compiledData_forced$sameFinger_up == 0] = '0/1/0'
compiledData_forced$errorType2_up[compiledData_forced$sameHand_up == 0 & compiledData_forced$sameCouplet_up == 0 & compiledData_forced$sameFinger_up == 1] = '0/0/1'
compiledData_forced$errorType2_up[compiledData_forced$sameHand_up == 0 & compiledData_forced$sameCouplet_up == 0 & compiledData_forced$sameFinger_up == 0] = '0/0/0'

compiledData_forced$treeDistance_stim = NA
compiledData_forced$treeDistance_stim[compiledData_forced$stim %in% c(1,2,3,4) & compiledData_forced$corrresp_prev %in% c(5,6,7,8)] = 6
compiledData_forced$treeDistance_stim[compiledData_forced$stim %in% c(5,6,7,8) & compiledData_forced$corrresp_prev %in% c(1,2,3,4)] = 6

compiledData_forced$treeDistance_stim[compiledData_forced$stim %in% c(1,2,3,4) & compiledData_forced$corrresp_prev %in% c(1,2,3,4)] = 4
compiledData_forced$treeDistance_stim[compiledData_forced$stim %in% c(5,6,7,8) & compiledData_forced$corrresp_prev %in% c(5,6,7,8)] = 4

compiledData_forced$treeDistance_stim[compiledData_forced$stim %in% c(1,2) & compiledData_forced$corrresp_prev %in% c(1,2)] = 2
compiledData_forced$treeDistance_stim[compiledData_forced$stim %in% c(3,4) & compiledData_forced$corrresp_prev %in% c(3,4)] = 2
compiledData_forced$treeDistance_stim[compiledData_forced$stim %in% c(5,6) & compiledData_forced$corrresp_prev %in% c(5,6)] = 2
compiledData_forced$treeDistance_stim[compiledData_forced$stim %in% c(7,8) & compiledData_forced$corrresp_prev %in% c(7,8)] = 2

compiledData_forced$treeDistance_stim[compiledData_forced$stim == compiledData_forced$corrresp_prev] = 0

compiledData_forced$treeDistance_stim[compiledData_forced$trialNum == 1] = NA


# CORRECT THE ZSCORE COLUMN
compiledData$rt_corrected_both_z= NA
compiledData = compiledData %>% group_by(subject) %>% dplyr::mutate(rt_corrected_both_z = scale(rt_corrected_both))

# add bins for preliminary analyses
compiledData_forced_trimmed = compiledData_forced %>% filter(PT_actual < 1.4)
compiledData_forced_trimmed$PT_bins = NA
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual < .1] = 0
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .1 & compiledData_forced_trimmed$PT_actual < .2] = .1
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .2 & compiledData_forced_trimmed$PT_actual < .3] = .2
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .3 & compiledData_forced_trimmed$PT_actual < .4] = .3
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .4 & compiledData_forced_trimmed$PT_actual < .5] = .4
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .5 & compiledData_forced_trimmed$PT_actual < .6] = .5
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .6 & compiledData_forced_trimmed$PT_actual < .7] = .6
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .7 & compiledData_forced_trimmed$PT_actual < .8] = .7
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .8 & compiledData_forced_trimmed$PT_actual < .9] = .8
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= .9 & compiledData_forced_trimmed$PT_actual < 1] = .9
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= 1 & compiledData_forced_trimmed$PT_actual < 1.1] = 1
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= 1.1 & compiledData_forced_trimmed$PT_actual < 1.2] = 1.1
compiledData_forced_trimmed$PT_bins[compiledData_forced_trimmed$PT_actual >= 1.2 & compiledData_forced_trimmed$PT_actual <= 1.3] = 1.2
subjNums_all = unique(compiledData$subject)

compiledData$neighbor = NA
compiledData$neighbor[!is.na(compiledData$fingerDistance)] = 0
compiledData$neighbor[compiledData$fingerDistance == 0] = 0
compiledData$neighbor[compiledData$fingerDistance == 1] = 1

  # talk figures
ribbonAlpha = 1
textColor = "black"
axisColor = "black"
axisTitleSize = 20
axisTextSize = 18
axisWidth = 1
tickWidth = 1
lineWidth = 1
tickLength = .25
```

\newpage
# Learning curves
```{r, echo=F, message=F, warning=F, error=T, fig.width=4, fig.height=4, fig.align='center' }
# Learning curve for Experiment 5
hierDyn = compiledData %>% filter(expt == 'hierDyn')
ribbonAlpha = 1
hierDyn_learningCurve= hierDyn %>% group_by(subject,iter) %>% dplyr::summarize(pCorHand = mean(corrHand,na.rm = TRUE), pCorCouplet = mean(corrCouplet,na.rm = TRUE), pCorFinger = mean(corr,na.rm = TRUE))
hierDyn_learningCurve_across = hierDyn_learningCurve %>% group_by(iter) %>% dplyr::summarize(acrosspCorHand = mean(pCorHand),acrosspCorCouplet = mean(pCorCouplet),acrosspCorFinger = mean(pCorFinger))

ggplot(hierDyn_learningCurve_across,aes(x=iter))+
  geom_line(aes(x = iter,y = acrosspCorHand, color = "hand"))+
  geom_line(aes(x = iter,y = acrosspCorCouplet, color = "couplet"))+
  geom_line(aes(x = iter,y = acrosspCorFinger, color = "overall accuracy"))+
  geom_ribbon(data=hierDyn_learningCurve_across,aes(x = iter,ymin = acrosspCorCouplet - se(acrosspCorCouplet), ymax = acrosspCorCouplet + se(acrosspCorCouplet)), inherit.aes = FALSE,fill = "red", alpha = ribbonAlpha)+
  geom_ribbon(data=hierDyn_learningCurve_across,aes(x = iter,ymin = acrosspCorHand - se(acrosspCorHand), ymax = acrosspCorHand + se(acrosspCorHand)), inherit.aes = FALSE,fill = "blue", alpha = ribbonAlpha)+
  geom_ribbon(data=hierDyn_learningCurve_across,aes(x = iter,ymin = acrosspCorFinger - se(acrosspCorFinger), ymax = acrosspCorFinger + se(acrosspCorFinger)), inherit.aes = FALSE,fill = "black", alpha = ribbonAlpha)+
  labs(x= 'stimulus iteration', y = 'accuracy')+ scale_y_continuous(expand = c(0,0), limits=c(0,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))+ 
  scale_color_manual(values = c("hand" = "blue","couplet" = "red","overall accuracy" = "black"),limits=c("hand","couplet","overall accuracy"))

# Learning curves for Experiment 6
flatDyn = compiledData %>% filter(expt == 'flatDyn')
flatDyn_learningCurve= flatDyn %>% group_by(subject,iter) %>% dplyr::summarize(pCorHand = mean(corrHand,na.rm = TRUE), pCorCouplet = mean(corrCouplet,na.rm = TRUE), pCorFinger = mean(corr,na.rm = TRUE))

flatDyn_learningCurve_across = flatDyn_learningCurve %>% group_by(iter) %>% dplyr::summarize(acrosspCorHand = mean(pCorHand),acrosspCorCouplet = mean(pCorCouplet),acrosspCorFinger = mean(pCorFinger))

ggplot(flatDyn_learningCurve_across,aes(x=iter))+
  geom_line(aes(x = iter,y = acrosspCorHand, color = "hand"))+
  geom_line(aes(x = iter,y = acrosspCorCouplet, color = "couplet"))+
  geom_line(aes(x = iter,y = acrosspCorFinger, color = "overall accuracy"))+
  geom_ribbon(data=flatDyn_learningCurve_across,aes(x = iter,ymin = acrosspCorCouplet - se(acrosspCorCouplet), ymax = acrosspCorCouplet + se(acrosspCorCouplet)), inherit.aes = FALSE,fill = "red", alpha = ribbonAlpha)+
  geom_ribbon(data=flatDyn_learningCurve_across,aes(x = iter,ymin = acrosspCorHand - se(acrosspCorHand), ymax = acrosspCorHand + se(acrosspCorHand)), inherit.aes = FALSE,fill = "blue", alpha = ribbonAlpha)+
  geom_ribbon(data=flatDyn_learningCurve_across,aes(x = iter,ymin = acrosspCorFinger - se(acrosspCorFinger), ymax = acrosspCorFinger + se(acrosspCorFinger)), inherit.aes = FALSE,fill = "black", alpha = ribbonAlpha)+
  labs(x= 'stimulus iteration', y = 'accuracy')+ scale_y_continuous(expand = c(0,0), limits=c(0,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))+ 
  scale_color_manual(values = c("hand" = "blue","couplet" = "red","overall accuracy" = "black"),limits=c("hand","couplet","overall accuracy"))
```
# Learning curves
```{r, echo=F, message=F, warning=F, error=T, fig.width=4, fig.height=4, fig.align='center' }
accuComp = compiledData %>% group_by(subject, expt) %>% dplyr::summarise(accu = mean(corr,na.rm = TRUE))
t.test(accuComp$accu[accuComp$expt ==  'hierDyn'],accuComp$accu[accuComp$expt == 'flatDyn'])

rtComp = compiledData %>% group_by(subject, expt) %>% filter(streak == 1) %>% dplyr::summarise(avgRT = mean(rt,na.rm = TRUE))
t.test(rtComp$avgRT[rtComp$expt == 'hierDyn'],rtComp$avgRT[rtComp$expt == 'flatDyn'])
```
\newpage
# tree distance figs
```{r, echo=F, message=F, warning=F, error=T, fig.width=3, fig.height=3, fig.align='center' }
hierDyn_tree_streak= hierDyn %>% filter(streak == 1) %>%group_by(subject, treeDistance) %>% filter(!is.na(treeDistance))%>% dplyr::summarize(avgRT = mean(rt_corrected_both,na.rm = TRUE))
t.test(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 6],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 4], paired = TRUE)
cohen.d(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 6],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 4],paired = TRUE)
t.test(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 6],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 2], paired = TRUE)
cohen.d(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 6],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 2],paired = TRUE)
t.test(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 6],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 0], paired = TRUE)
cohen.d(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 6],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 0],paired = TRUE)
t.test(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 4],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 2], paired = TRUE)
cohen.d(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 4],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 2],paired = TRUE)
t.test(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 4],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 0], paired = TRUE)
cohen.d(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 4],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 0],paired = TRUE)
t.test(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 2],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 0], paired = TRUE)
cohen.d(hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 2],hierDyn_tree_streak$avgRT[hierDyn_tree_streak$treeDistance == 0],paired = TRUE)

hierDyn_tree_streak_summaryStats = summarySEwithin(hierDyn_tree_streak,measurevar="avgRT", withinvars=c("treeDistance"),idvar="subject", na.rm=FALSE, conf.interval=.95)

ggplot(hierDyn_tree_streak_summaryStats, aes(x = as.factor(treeDistance), y = avgRT)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=avgRT-se, ymax=avgRT+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'RT')+
  scale_y_continuous(expand = c(0,0), limits = c(0,900))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
ggplot(hierDyn_tree_streak_summaryStats, aes(x = as.factor(treeDistance), y = avgRT)) + 
  geom_bar(stat = "identity", position = "dodge") +
  
  # Shift error bars slightly to the left
  geom_errorbar(aes(x = as.numeric(as.factor(treeDistance)) - 0.1, 
                    ymin = avgRT - se, ymax = avgRT + se), 
                width = 0.2, position = position_dodge(0.9)) +
  
  # Shift points slightly to the left and jitter them
  geom_point(data = hierDyn_tree_streak, 
             aes(x = as.numeric(as.factor(treeDistance)) + 0.1, y = avgRT), 
             position = position_jitter(width = 0.1), alpha = 1) +
  
  labs(x = 'Tree Distance', y = 'RT') +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1750)) +
  
  theme(
    panel.grid = element_blank(),
    panel.background = element_rect(fill = "white", colour = "black"),
    panel.border = element_rect(fill = NA, colour = "white"),
    strip.text = element_text(size = axisTitleSize), 
    axis.title.x = element_text(size = axisTitleSize), 
    axis.title.y = element_text(size = axisTitleSize), 
    axis.text.x = element_text(size = axisTextSize, color = textColor), 
    axis.text.y = element_text(size = axisTextSize, color = textColor), 
    axis.line.x.bottom = element_line(size = axisWidth), 
    axis.line.y.left = element_line(size = axisWidth), 
    axis.ticks = element_line(colour = axisColor, size = tickWidth), 
    axis.ticks.length = unit(tickLength, "cm")
  )
#ggsave('treeDistance_hierDyn_wpoints.eps')


flatDyn_tree_streak= flatDyn %>% filter(streak == 1) %>%group_by(subject, treeDistance) %>% filter(!is.na(treeDistance))%>% dplyr::summarize(avgRT = mean(rt_corrected_both,na.rm = TRUE))
t.test(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 6],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 4], paired = TRUE)
cohen.d(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 6],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 4],paired = TRUE)
t.test(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 6],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 2], paired = TRUE)
cohen.d(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 6],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 2],paired = TRUE)
t.test(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 6],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 0], paired = TRUE)
cohen.d(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 6],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 0],paired = TRUE)
t.test(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 4],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 2], paired = TRUE)
cohen.d(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 4],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 2],paired = TRUE)
t.test(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 4],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 0], paired = TRUE)
cohen.d(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 4],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 0],paired = TRUE)
t.test(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 2],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 0], paired = TRUE)
cohen.d(flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 2],flatDyn_tree_streak$avgRT[flatDyn_tree_streak$treeDistance == 0],paired = TRUE)
flatDyn_tree_streak_summaryStats = summarySEwithin(flatDyn_tree_streak,measurevar="avgRT", withinvars=c("treeDistance"),idvar="subject", na.rm=FALSE, conf.interval=.95)

ggplot(flatDyn_tree_streak_summaryStats, aes(x = as.factor(treeDistance), y = avgRT)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=avgRT-se, ymax=avgRT+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'RT')+
  scale_y_continuous(expand = c(0,0), limits = c(0,900))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

ggplot(flatDyn_tree_streak_summaryStats, aes(x = as.factor(treeDistance), y = avgRT)) + 
  geom_bar(stat = "identity", position = "dodge") +
  
  # Shift error bars slightly to the left
  geom_errorbar(aes(x = as.numeric(as.factor(treeDistance)) - 0.1, 
                    ymin = avgRT - se, ymax = avgRT + se), 
                width = 0.2, position = position_dodge(0.9)) +
  
  # Shift points slightly to the left and jitter them
  geom_point(data = flatDyn_tree_streak, 
             aes(x = as.numeric(as.factor(treeDistance)) + 0.1, y = avgRT), 
             position = position_jitter(width = 0.1), alpha = 1) +
  
  labs(x = 'Tree Distance', y = 'RT') +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1750)) +
  
  theme(
    panel.grid = element_blank(),
    panel.background = element_rect(fill = "white", colour = "black"),
    panel.border = element_rect(fill = NA, colour = "white"),
    strip.text = element_text(size = axisTitleSize), 
    axis.title.x = element_text(size = axisTitleSize), 
    axis.title.y = element_text(size = axisTitleSize), 
    axis.text.x = element_text(size = axisTextSize, color = textColor), 
    axis.text.y = element_text(size = axisTextSize, color = textColor), 
    axis.line.x.bottom = element_line(size = axisWidth), 
    axis.line.y.left = element_line(size = axisWidth), 
    axis.ticks = element_line(colour = axisColor, size = tickWidth), 
    axis.ticks.length = unit(tickLength, "cm")
  )
#ggsave('treeDistance_flatDyn_wpoints.eps')

```
# tree distance figs - accuracy
```{r, echo=F, message=F, warning=F, error=T, fig.width=3, fig.height=3, fig.align='center' }
hierDyn_tree_accu= hierDyn %>% filter(iter >= 40) %>%group_by(subject, treeDistance) %>% filter(!is.na(treeDistance))%>% dplyr::summarize(accu = mean(corr,na.rm = TRUE))
hierDyn_tree_accu_summaryStats = summarySEwithin(hierDyn_tree_accu,measurevar="accu", withinvars=c("treeDistance"),idvar="subject", na.rm=FALSE, conf.interval=.95)

ggplot(hierDyn_tree_accu_summaryStats, aes(x = as.factor(treeDistance), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'accu')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))



flatDyn_tree_accu= flatDyn %>% filter(iter>=40) %>%group_by(subject, treeDistance) %>% filter(!is.na(treeDistance))%>% dplyr::summarize(accu = mean(corr,na.rm = TRUE))
flatDyn_tree_accu_summaryStats = summarySEwithin(flatDyn_tree_accu,measurevar="accu", withinvars=c("treeDistance"),idvar="subject", na.rm=FALSE, conf.interval=.95)

ggplot(flatDyn_tree_accu_summaryStats, aes(x = as.factor(treeDistance), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'accu')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))


```
\newpage
# MEM of streak trials
```{r, echo=F, message=F, warning=F, error=T, fig.width=3.5, fig.height=3, fig.align='center'}
#models
#tree
hierDyn_ModelData_streak = hierDyn %>% filter(streak == 1,trialNum > 3, !is.na(treeDistance), !is.na(nFeatureSwitch), !is.na(fingerDistance))
hierDyn_MEM_tree_streak = lmer(rt_corrected_both ~ as.numeric(treeDistance)+(1|subject), data = hierDyn_ModelData_streak, na.action = na.exclude)
# flat
hierDyn_MEM_flat_streak = lmer(rt_corrected_both ~ as.numeric(fingerSwitch_actual)+(1|subject), data = hierDyn_ModelData_streak, na.action = na.exclude)
# feature sw
hierDyn_MEM_feature_streak = lmer(rt_corrected_both ~ as.numeric(nFeatureSwitch)+(1|subject), data = hierDyn_ModelData_streak, na.action = na.exclude)
# finger
hierDyn_MEM_finger_streak = lmer(rt_corrected_both ~ as.numeric(fingerDistance)+(1|subject), data = hierDyn_ModelData_streak, na.action = na.exclude)
# neighbor
hierDyn_MEM_neighbor_streak = lmer(rt_corrected_both ~ as.numeric(neighbor)+(1|subject), data = hierDyn_ModelData_streak, na.action = na.exclude)

AIC(hierDyn_MEM_tree_streak,hierDyn_MEM_flat_streak,hierDyn_MEM_feature_streak,hierDyn_MEM_finger_streak,hierDyn_MEM_neighbor_streak)
BIC(hierDyn_MEM_tree_streak,hierDyn_MEM_flat_streak,hierDyn_MEM_feature_streak,hierDyn_MEM_finger_streak,hierDyn_MEM_neighbor_streak)

#models
#tree
flatDyn_ModelData_streak = flatDyn %>% filter(streak == 1,trialNum > 3, !is.na(treeDistance), !is.na(nFeatureSwitch), !is.na(fingerDistance))
flatDyn_MEM_tree_streak = lmer(rt_corrected_both ~  as.numeric(treeDistance)+(1|subject), data = flatDyn_ModelData_streak, na.action = na.exclude)
# flat
flatDyn_MEM_flat_streak = lmer(rt_corrected_both ~  as.numeric(fingerSwitch_actual)+(1|subject), data = flatDyn_ModelData_streak, na.action = na.exclude)
# finger
flatDyn_MEM_finger_streak = lmer(rt_corrected_both ~  as.numeric(fingerDistance)+(1|subject), data = flatDyn_ModelData_streak, na.action = na.exclude)
# neighbor
flatDyn_MEM_neighbor_streak = lmer(rt_corrected_both ~  as.numeric(neighbor)+(1|subject), data = flatDyn_ModelData_streak, na.action = na.exclude)

AIC(flatDyn_MEM_tree_streak,flatDyn_MEM_flat_streak,flatDyn_MEM_finger_streak,flatDyn_MEM_neighbor_streak)
BIC(flatDyn_MEM_tree_streak,flatDyn_MEM_flat_streak,flatDyn_MEM_finger_streak,flatDyn_MEM_neighbor_streak)


```

# model AIC/BIC all experiments
```{r, echo=F, message=F, warning=F, error=T, fig.width=3.5, fig.height=3, fig.align='center'}
hierDyn_BIC = BIC(hierDyn_MEM_tree_streak,hierDyn_MEM_flat_streak,hierDyn_MEM_feature_streak,hierDyn_MEM_finger_streak,hierDyn_MEM_neighbor_streak)
hierDyn_BIC$delta = hierDyn_BIC$BIC-hierDyn_BIC$BIC[1]
hierDyn_BIC$model = c('tree','flat','feature','finger','neighbor')
hierDyn_BIC_delta = hierDyn_BIC %>% filter(model != 'tree')

flatDyn_BIC = BIC(flatDyn_MEM_tree_streak,flatDyn_MEM_flat_streak,flatDyn_MEM_finger_streak,flatDyn_MEM_neighbor_streak)
flatDyn_BIC$delta = flatDyn_BIC$BIC-flatDyn_BIC$BIC[1]
flatDyn_BIC$model = c('tree','flat','finger','neighbor')
flatDyn_BIC_delta = flatDyn_BIC %>% filter(model != 'tree')

ggplot(hierDyn_BIC, aes(x = NA, y = BIC, color = model))+geom_point()+
   scale_y_continuous()+
  theme(panel.grid = element_blank(),legend.position = 'none',
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"),
        legend.title = element_text(size = axisTextSize),
        legend.text = element_text(size = axisTextSize))

flatDyn_BIC_less = flatDyn_BIC %>% filter(model %in% c('flat','tree','finger', 'neighbor'))

ggplot(flatDyn_BIC_less, aes(x = NA, y = BIC, color = model ))+geom_point()+  
   scale_y_continuous()+
  theme(panel.grid = element_blank(),legend.position = 'none',
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"),
        legend.title = element_text(size = axisTextSize),
        legend.text = element_text(size = axisTextSize))
```
# model AIC/BIC all experiments
```{r, echo=F, message=F, warning=F, error=T, fig.width=1.5, fig.height=2, fig.align='center'}
ggplot(hierDyn_BIC_delta, aes(x = NA, y = delta, color = model))+geom_point()+
  geom_hline(yintercept = 0)+
   scale_y_continuous(expand = c(0,0), limits = c(-100, 975))+
  theme(panel.grid = element_blank(),legend.position = 'none',
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"),
        legend.title = element_text(size = axisTextSize),
        legend.text = element_text(size = axisTextSize))
#ggsave('hierDyn_mem_wneighbor.eps')

ggplot(flatDyn_BIC_delta, aes(x = NA, y = delta,color = model ))+geom_point()+  
    geom_hline(yintercept = 0)+
   scale_y_continuous(expand = c(0,0),limits = c(-150, 150))+
  theme(panel.grid = element_blank(),legend.position = 'none',
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"),
        legend.title = element_text(size = axisTextSize),
        legend.text = element_text(size = axisTextSize))
#ggsave('flatDyn_mem_wneighbor.eps')
```
\newpage
# clustering analyses
# function for clustering and visualization
```{r, echo=F, message=F, warning=F, error=T, fig.width=4, fig.height=4, fig.align='center' }
library(ggdendro)
library(ggplotify)

# Helpful documentation for clustering package: https://uc-r.github.io/hc_clustering
clustering_vis = function(mainData,type,iters,correct){
  # function to plot the main clustering figures for hierlearn data
  # It takes in a dataframe, arranges it into a currResp x prevResp RT matrix and then runs the clustering algorithms and visualizations
  # first input is the dataframe with all data for the included subjects
  # second input says whether it's learning or motor - 'learn' 'motor'
  # third input tells it what iters to include 'all' - all, 'start' - first 20, 'end' - last 20 (ONLY AVAILABLE FOR LEARNING DATA)
  # fourth says what trials to include 'all' 'corr' 'streak'
  
  if(type == 'learn'){
    if(iters == 'all'){
      if(correct == 'all'){
      rt_mat = mainData %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='corr'){
        rt_mat = mainData %>% filter(corr ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='streak'){

        
                rt_mat = mainData %>% filter(streak ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }
    }else if(iters == 'start'){
      if(correct == 'all'){
      rt_mat = mainData %>% filter(iter <26) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='corr'){
        rt_mat = mainData %>% filter(iter <26,corr ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='streak'){
        rt_mat = mainData %>% filter(iter <26,streak ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }
    }else if(iters == 'end'){
      if(correct == 'all'){
      rt_mat = mainData %>% filter(iter >= (max(mainData$iter, na.rm = TRUE)-25)) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='corr'){
        rt_mat = mainData %>% filter(iter >= (max(mainData$iter, na.rm = TRUE)-25),corr ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='streak'){
        rt_mat = mainData %>% filter(iter >= (max(mainData$iter, na.rm = TRUE)-25),streak ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }
    }
  }else if(type == 'motor'){
    if(iters == 'all'){
      if(correct == 'all'){
      rt_mat = mainData %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='corr'){
        rt_mat = mainData %>% filter(corr ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='streak'){
        print('NO STREAK TRIALS DEFINED FOR MOTOR DATA')
      }
    }else{
      print('NO ITERS DEFINED FOR MOTOR DATA')
    }
  }else{
    print('MUST INDICATE DATA TYPE')
  }
  
  rt_mat_wide = rt_mat %>% pivot_wider(names_from = finger_press_prev,values_from=avgRT)
  
  distanceVec = get_dist(rt_mat_wide)
  #fviz_dist(distanceVec, gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"))
  ka = kmeans(distanceVec,centers = 4, nstart = 25)
  #fviz_cluster(ka, data = a)
  hier_rt_mat = dist(rt_mat_wide, method = 'euclidean')
  h1=hclust(hier_rt_mat, method = "complete")
  list(fviz_dist(distanceVec, gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07")),fviz_cluster(ka, data = distanceVec),plot(h1, cex = 0.6, hang = -1))
  #ggsave('dendro.eps',plot=as.ggplot(plot(h1, cex = 0.6, hang = -1)))
}


dendrogram_vis = function(mainData,type,iters,correct){
  # function to plot the main clustering figures for hierlearn data
  # It takes in a dataframe, arranges it into a currResp x prevResp RT matrix and then runs the clustering algorithms and visualizations
  # first input is the dataframe with all data for the included subjects
  # second input says whether it's learning or motor - 'learn' 'motor'
  # third input tells it what iters to include 'all' - all, 'start' - first 20, 'end' - last 20 (ONLY AVAILABLE FOR LEARNING DATA)
  # fourth says what trials to include 'all' 'corr' 'streak'
  
  if(type == 'learn'){
    if(iters == 'all'){
      if(correct == 'all'){
      rt_mat = mainData %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='corr'){
        rt_mat = mainData %>% filter(corr ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='streak'){
        rt_mat = mainData %>% filter(streak ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }
    }else if(iters == 'start'){
      if(correct == 'all'){
      rt_mat = mainData %>% filter(iter <26) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='corr'){
        rt_mat = mainData %>% filter(iter <26,corr ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='streak'){
        rt_mat = mainData %>% filter(iter <26,streak ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }
    }else if(iters == 'end'){
      if(correct == 'all'){
      rt_mat = mainData %>% filter(iter >= (max(mainData$iter, na.rm = TRUE)-25)) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='corr'){
        rt_mat = mainData %>% filter(iter >= (max(mainData$iter, na.rm = TRUE)-25),corr ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='streak'){
        rt_mat = mainData %>% filter(iter >= (max(mainData$iter, na.rm = TRUE)-25),streak ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt_corrected_both, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }
    }
  }else if(type == 'motor'){
    if(iters == 'all'){
      if(correct == 'all'){
      rt_mat = mainData %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='corr'){
        rt_mat = mainData %>% filter(corr ==1) %>% group_by(subject,resp, finger_press_prev) %>% dplyr::summarise(avgRT = mean(rt, na.rm = TRUE)) %>%group_by(resp,finger_press_prev) %>% dplyr::summarise(avgRT = mean(avgRT))
      }else if(correct=='streak'){
        print('NO STREAK TRIALS DEFINED FOR MOTOR DATA')
      }
    }else{
      print('NO ITERS DEFINED FOR MOTOR DATA')
    }
  }else{
    print('MUST INDICATE DATA TYPE')
  }
  
  rt_mat_wide = rt_mat %>% pivot_wider(names_from = finger_press_prev,values_from=avgRT)
  
  distanceVec = get_dist(rt_mat_wide)
  #fviz_dist(distanceVec, gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"))
  ka = kmeans(distanceVec,centers = 4, nstart = 25)
  #fviz_cluster(ka, data = a)
  hier_rt_mat = dist(rt_mat_wide, method = 'euclidean')
  h1=hclust(hier_rt_mat, method = "complete")
#ggplot() +
 # geom_dendrogram(data = h1, color = "blue", size = 2) +
  #theme_minimal() +
  #labs(title = "Hierarchical Clustering Dendrogram")
  ggdendrogram(h1,, rotate = FALSE, size = 2)
#ggsave('dendro.eps')
}
```
# clustering plots, learning, all iters, correct trials
```{r, echo=F, message=F, warning=F, error=T, fig.width=4, fig.height=4, fig.align='center' }
(dendrogram_vis(hierDyn,'learn','all','streak'))
(dendrogram_vis(flatDyn,'learn','all','streak'))

```
\newpage
# P(response type) x PT (all 8 response types)
```{r, echo=F, message=F, warning=F, error=T, fig.width=12, fig.height=6, fig.align='center'}
minTime = min(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
maxTime = max(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
step = .01
win = .05
timepoints = seq(0,maxTime,step)

# HIERDYN
# set up the dataframe
HL_smoothedData_errorType2 = data.frame(matrix(NA, ncol = 10,nrow = length(timepoints)*length(subjNums_hierDyn)))
colnames(HL_smoothedData_errorType2) = c('subject','tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

for(si in 1:length(subjNums_hierDyn)){
  subjData = compiledData_forced_trimmed %>% filter(subject == subjNums_hierDyn[si],timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorType2$subject[ti+(length(timepoints)*(si-1))] = subjNums_hierDyn[si]
    HL_smoothedData_errorType2$tp[ti+(length(timepoints)*(si-1))] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(subjData$PT_actual > (timepoints[ti]-win) & subjData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = subjData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorType2 = HL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorType2$zerozerozero[ti+(length(timepoints)*(si-1))] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/0']
      HL_smoothedData_errorType2$zerozeroone[ti+(length(timepoints)*(si-1))] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/1']
      HL_smoothedData_errorType2$zeroonezero[ti+(length(timepoints)*(si-1))]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/0']
      HL_smoothedData_errorType2$zerooneone[ti+(length(timepoints)*(si-1))]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/1']
      
      HL_smoothedData_errorType2$onezerozero[ti+(length(timepoints)*(si-1))]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/0']
      HL_smoothedData_errorType2$onezeroone[ti+(length(timepoints)*(si-1))]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/1']
      HL_smoothedData_errorType2$oneonezero[ti+(length(timepoints)*(si-1))] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/0']
      HL_smoothedData_errorType2$oneoneone[ti+(length(timepoints)*(si-1))] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/1']
      }
    }
}

HL_smoothedData_errorType2 = pivot_longer(HL_smoothedData_errorType2, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
HL_smoothedData_errorType2$subject=as.factor(HL_smoothedData_errorType2$subject)
HL_smoothedData_errorType2$errorType2 = as.factor(HL_smoothedData_errorType2$errorType2)
HL_smoothedData_errorType2$errorType2_num = NA
HL_smoothedData_errorType2$errorType2_num[HL_smoothedData_errorType2$errorType2 == 'oneoneone'] = '1/1/1'
HL_smoothedData_errorType2$errorType2_num[HL_smoothedData_errorType2$errorType2 == 'oneonezero'] = '1/1/0'
HL_smoothedData_errorType2$errorType2_num[HL_smoothedData_errorType2$errorType2 == 'onezeroone'] = '1/0/1'
HL_smoothedData_errorType2$errorType2_num[HL_smoothedData_errorType2$errorType2 == 'onezerozero'] = '1/0/0'

HL_smoothedData_errorType2$errorType2_num[HL_smoothedData_errorType2$errorType2 == 'zerooneone'] = '0/1/1'
HL_smoothedData_errorType2$errorType2_num[HL_smoothedData_errorType2$errorType2 == 'zeroonezero'] = '0/1/0'
HL_smoothedData_errorType2$errorType2_num[HL_smoothedData_errorType2$errorType2 == 'zerozeroone'] = '0/0/1'
HL_smoothedData_errorType2$errorType2_num[HL_smoothedData_errorType2$errorType2 == 'zerozerozero'] = '0/0/0'
HL_smoothedData_errorType2$tp = as.numeric(HL_smoothedData_errorType2$tp)

HL_smoothedData_errorType2_plotting = HL_smoothedData_errorType2 %>% group_by(subject, errorType2_num, .drop = FALSE) 
HL_smoothedData_errorType2_plotting_summary = summarySEwithin(HL_smoothedData_errorType2, measurevar = 'prop',withinvars = c('tp','errorType2_num'), idvar = 'subject', na.rm = TRUE)

# FLATDYN
# set up the dataframe
FL_smoothedData_errorType2 = data.frame(matrix(NA, ncol = 10,nrow = length(timepoints)*length(subjNums_flatDyn)))
colnames(FL_smoothedData_errorType2) = c('subject','tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

for(si in 1:length(subjNums_flatDyn)){
  subjData = compiledData_forced_trimmed %>% filter(subject == subjNums_flatDyn[si],timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorType2$subject[ti+(length(timepoints)*(si-1))] = subjNums_flatDyn[si]
    FL_smoothedData_errorType2$tp[ti+(length(timepoints)*(si-1))] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(subjData$PT_actual > (timepoints[ti]-win) & subjData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = subjData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorType2 = FL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorType2$zerozerozero[ti+(length(timepoints)*(si-1))] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/0']
      FL_smoothedData_errorType2$zerozeroone[ti+(length(timepoints)*(si-1))] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/1']
      FL_smoothedData_errorType2$zeroonezero[ti+(length(timepoints)*(si-1))]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/0']
      FL_smoothedData_errorType2$zerooneone[ti+(length(timepoints)*(si-1))]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/1']
      
      FL_smoothedData_errorType2$onezerozero[ti+(length(timepoints)*(si-1))]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/0']
      FL_smoothedData_errorType2$onezeroone[ti+(length(timepoints)*(si-1))]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/1']
      FL_smoothedData_errorType2$oneonezero[ti+(length(timepoints)*(si-1))] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/0']
      FL_smoothedData_errorType2$oneoneone[ti+(length(timepoints)*(si-1))] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/1']
      }
    }
}

FL_smoothedData_errorType2 = pivot_longer(FL_smoothedData_errorType2, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
FL_smoothedData_errorType2$subject=as.factor(FL_smoothedData_errorType2$subject)
FL_smoothedData_errorType2$errorType2 = as.factor(FL_smoothedData_errorType2$errorType2)
FL_smoothedData_errorType2$errorType2_num = NA
FL_smoothedData_errorType2$errorType2_num[FL_smoothedData_errorType2$errorType2 == 'oneoneone'] = '1/1/1'
FL_smoothedData_errorType2$errorType2_num[FL_smoothedData_errorType2$errorType2 == 'oneonezero'] = '1/1/0'
FL_smoothedData_errorType2$errorType2_num[FL_smoothedData_errorType2$errorType2 == 'onezeroone'] = '1/0/1'
FL_smoothedData_errorType2$errorType2_num[FL_smoothedData_errorType2$errorType2 == 'onezerozero'] = '1/0/0'

FL_smoothedData_errorType2$errorType2_num[FL_smoothedData_errorType2$errorType2 == 'zerooneone'] = '0/1/1'
FL_smoothedData_errorType2$errorType2_num[FL_smoothedData_errorType2$errorType2 == 'zeroonezero'] = '0/1/0'
FL_smoothedData_errorType2$errorType2_num[FL_smoothedData_errorType2$errorType2 == 'zerozeroone'] = '0/0/1'
FL_smoothedData_errorType2$errorType2_num[FL_smoothedData_errorType2$errorType2 == 'zerozerozero'] = '0/0/0'
FL_smoothedData_errorType2$tp = as.numeric(FL_smoothedData_errorType2$tp)

FL_smoothedData_errorType2_plotting = FL_smoothedData_errorType2 %>% group_by(subject, errorType2_num, .drop = FALSE) 
FL_smoothedData_errorType2_plotting_summary = summarySEwithin(FL_smoothedData_errorType2, measurevar = 'prop',withinvars = c('tp','errorType2_num'), idvar = 'subject', na.rm = TRUE)
FL_smoothedData_errorType2_plotting_summary_trimmed = FL_smoothedData_errorType2_plotting_summary 

# PLOT Experiment 5
HL_smoothedData_errorType2_plotting_summary_trimmed = HL_smoothedData_errorType2_plotting_summary %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorType2_plotting_summary_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+geom_ribbon(data=HL_smoothedData_errorType2_plotting_summary_trimmed,aes(x = tp,ymin = prop - se, ymax = prop + se, fill = errorType2_num), inherit.aes = TRUE)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

# Plot Experiment 6
FL_smoothedData_errorType2_plotting_summary_trimmed = FL_smoothedData_errorType2_plotting_summary %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorType2_plotting_summary_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+geom_ribbon(data=FL_smoothedData_errorType2_plotting_summary_trimmed,aes(x = tp,ymin = prop - se, ymax = prop + se, fill = errorType2_num), inherit.aes = TRUE)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

```
# P(response type) x PT (without p(correct) for legibility purposes)
```{r, echo=F, message=F, warning=F, error=T,fig.width=6, fig.height=4, fig.align='center'}
alpha = .5
HL_smoothedData_errorType2_plotting_summary_trimmed_nocorr = HL_smoothedData_errorType2_plotting_summary %>% filter(tp %in% seq(.1,1.2,step), errorType2_num != '1/1/1')

ggplot(HL_smoothedData_errorType2_plotting_summary_trimmed_nocorr, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+geom_ribbon(data=HL_smoothedData_errorType2_plotting_summary_trimmed_nocorr,aes(x = tp,ymin = prop - se, ymax = prop + se, fill = errorType2_num), inherit.aes = TRUE)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(expand = c(0,0),limits = c(0,.25), breaks = c(0,.2))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))


FL_smoothedData_errorType2_plotting_summary_trimmed_nocorr = FL_smoothedData_errorType2_plotting_summary %>% filter(tp %in% seq(.1,1.2,step), errorType2_num != '1/1/1')

ggplot(FL_smoothedData_errorType2_plotting_summary_trimmed_nocorr, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+geom_ribbon(data=FL_smoothedData_errorType2_plotting_summary_trimmed_nocorr,aes(x = tp,ymin = prop - se, ymax = prop + se, fill = errorType2_num), inherit.aes = TRUE)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(expand = c(0,0),limits = c(0,.25), breaks = c(0,.2))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
```
# P(response level) x PT (errorlevel)
```{r, echo=F, message=F, warning=F, error=T, fig.width=12, fig.height=6, fig.align='center'}
# HIERDYN
# set up the dataframe
HL_smoothedData_errorLevel = data.frame(matrix(NA, ncol = 6,nrow = length(timepoints)*length(subjNums_hierDyn)))
colnames(HL_smoothedData_errorLevel) = c('subject','tp', 'acorr', 'bbottom','cmid','dtop')
compiledData_forced_trimmed$errorLevel = as.factor(compiledData_forced_trimmed$errorLevel)
for(si in 1:length(subjNums_hierDyn)){
  subjData = compiledData_forced_trimmed %>% filter(subject == subjNums_hierDyn[si],timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorLevel$subject[ti+(length(timepoints)*(si-1))] = subjNums_hierDyn[si]
    HL_smoothedData_errorLevel$tp[ti+(length(timepoints)*(si-1))] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(subjData$PT_actual > (timepoints[ti]-win) & subjData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = subjData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorLevel = HL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorLevel$acorr[ti+(length(timepoints)*(si-1))] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'acorr']
      HL_smoothedData_errorLevel$bbottom[ti+(length(timepoints)*(si-1))] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'bbottom']
      HL_smoothedData_errorLevel$cmid[ti+(length(timepoints)*(si-1))]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'cmid']
      HL_smoothedData_errorLevel$dtop[ti+(length(timepoints)*(si-1))]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'dtop']
      }
    }
}

HL_smoothedData_errorLevel = pivot_longer(HL_smoothedData_errorLevel, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
HL_smoothedData_errorLevel$subject=as.factor(HL_smoothedData_errorLevel$subject)
HL_smoothedData_errorLevel$errorLevel = as.factor(HL_smoothedData_errorLevel$errorLevel)
HL_smoothedData_errorLevel$tp = as.numeric(HL_smoothedData_errorLevel$tp)

HL_smoothedData_errorLevel_plotting = HL_smoothedData_errorLevel %>% group_by(subject, errorLevel, .drop = FALSE) 
HL_smoothedData_errorLevel_plotting_summary = summarySEwithin(HL_smoothedData_errorLevel, measurevar = 'prop',withinvars = c('tp','errorLevel'), idvar = 'subject', na.rm = TRUE)
HL_smoothedData_errorLevel_plotting_summary$prop_corrected = HL_smoothedData_errorLevel_plotting_summary$prop
HL_smoothedData_errorLevel_plotting_summary$prop_corrected[HL_smoothedData_errorLevel_plotting_summary$errorLevel == 'dtop'] = HL_smoothedData_errorLevel_plotting_summary$prop_corrected[HL_smoothedData_errorLevel_plotting_summary$errorLevel == 'dtop']/4
HL_smoothedData_errorLevel_plotting_summary$prop_corrected[HL_smoothedData_errorLevel_plotting_summary$errorLevel == 'cmid'] = HL_smoothedData_errorLevel_plotting_summary$prop_corrected[HL_smoothedData_errorLevel_plotting_summary$errorLevel == 'cmid']/2
# FLATDYN
# set up the dataframe
FL_smoothedData_errorLevel = data.frame(matrix(NA, ncol = 6,nrow = length(timepoints)*length(subjNums_flatDyn)))
colnames(FL_smoothedData_errorLevel) = c('subject','tp', 'acorr', 'bbottom','cmid','dtop')

for(si in 1:length(subjNums_flatDyn)){
  subjData = compiledData_forced_trimmed %>% filter(subject == subjNums_flatDyn[si],timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorLevel$subject[ti+(length(timepoints)*(si-1))] = subjNums_flatDyn[si]
    FL_smoothedData_errorLevel$tp[ti+(length(timepoints)*(si-1))] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(subjData$PT_actual > (timepoints[ti]-win) & subjData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = subjData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorLevel = FL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorLevel$acorr[ti+(length(timepoints)*(si-1))] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'acorr']
      FL_smoothedData_errorLevel$bbottom[ti+(length(timepoints)*(si-1))] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'bbottom']
      FL_smoothedData_errorLevel$cmid[ti+(length(timepoints)*(si-1))]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'cmid']
      FL_smoothedData_errorLevel$dtop[ti+(length(timepoints)*(si-1))]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'dtop']
      }
    }
}
FL_smoothedData_errorLevel = pivot_longer(FL_smoothedData_errorLevel, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
FL_smoothedData_errorLevel$subject=as.factor(FL_smoothedData_errorLevel$subject)
FL_smoothedData_errorLevel$errorLevel = as.factor(FL_smoothedData_errorLevel$errorLevel)
FL_smoothedData_errorLevel$tp = as.numeric(FL_smoothedData_errorLevel$tp)

FL_smoothedData_errorLevel_plotting = FL_smoothedData_errorLevel %>% group_by(subject, errorLevel, .drop = FALSE) 
FL_smoothedData_errorLevel_plotting_summary = summarySEwithin(FL_smoothedData_errorLevel, measurevar = 'prop',withinvars = c('tp','errorLevel'), idvar = 'subject', na.rm = TRUE)
FL_smoothedData_errorLevel_plotting_summary$prop_corrected = FL_smoothedData_errorLevel_plotting_summary$prop
FL_smoothedData_errorLevel_plotting_summary$prop_corrected[FL_smoothedData_errorLevel_plotting_summary$errorLevel == 'dtop'] = FL_smoothedData_errorLevel_plotting_summary$prop_corrected[FL_smoothedData_errorLevel_plotting_summary$errorLevel == 'dtop']/4
FL_smoothedData_errorLevel_plotting_summary$prop_corrected[FL_smoothedData_errorLevel_plotting_summary$errorLevel == 'cmid'] = FL_smoothedData_errorLevel_plotting_summary$prop_corrected[FL_smoothedData_errorLevel_plotting_summary$errorLevel == 'cmid']/2
# PLOT Experiment 5
HL_smoothedData_errorLevel_plotting_summary_trimmed = HL_smoothedData_errorLevel_plotting_summary %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorLevel_plotting_summary_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+geom_ribbon(data=HL_smoothedData_errorLevel_plotting_summary_trimmed,aes(x = tp,ymin = prop_corrected - se, ymax = prop_corrected + se, fill = errorLevel), inherit.aes = TRUE, alpha = alpha)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

# Plot Experiment 6
FL_smoothedData_errorLevel_plotting_summary_trimmed = FL_smoothedData_errorLevel_plotting_summary %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorLevel_plotting_summary_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+geom_ribbon(data=FL_smoothedData_errorLevel_plotting_summary_trimmed,aes(x = tp,ymin = prop_corrected - se, ymax = prop_corrected + se, fill = errorLevel), inherit.aes = TRUE, alpha = alpha)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

```

\newpage
# top mid low level errors (corrected probabilities) with eml2
```{r, echo=F, message=F, warning=F, error=T,fig.width=4, fig.height=2, fig.align='center'}
errorLevel_eml2 = compiledData_forced_trimmed %>% filter(timing == 1,!is.na(eml),!is.na(errorType2),!is.na(eml2)) %>% group_by(expt,subject,eml2,errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% filter(!is.na(errorLevel)) %>% group_by(expt,subject, eml2,.drop = FALSE) %>% dplyr::mutate(prop = counts/sum(counts))

errorLevel_eml2$prop_corrected = errorLevel_eml2$prop
errorLevel_eml2$prop_corrected[errorLevel_eml2$errorLevel == 'dtop'] = errorLevel_eml2$prop_corrected[errorLevel_eml2$errorLevel == 'dtop']/4
errorLevel_eml2$prop_corrected[errorLevel_eml2$errorLevel == 'cmid'] = errorLevel_eml2$prop_corrected[errorLevel_eml2$errorLevel == 'cmid']/2

errorLevel_eml2_summary = summarySEwithin(errorLevel_eml2, measurevar = 'prop_corrected',withinvars = c('errorLevel','eml2'),betweenvars = 'expt', idvar = 'subject', na.rm = TRUE)
errorLevel_eml2_summary_HD = errorLevel_eml2_summary %>% filter(expt == 'hierDyn')
errorLevel_eml2_summary_FD = errorLevel_eml2_summary %>% filter(expt == 'flatDyn')


ggplot(errorLevel_eml2_summary_HD, aes(x =errorLevel,y = prop_corrected, group = errorLevel,fill = errorLevel)) + geom_bar(stat = 'identity')+ geom_errorbar(aes(x = errorLevel,ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+facet_wrap(~expt+eml2)+scale_y_continuous(expand = c(0,0))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

ggplot(errorLevel_eml2_summary_FD, aes(x =errorLevel,y = prop_corrected, group = errorLevel,fill = errorLevel)) + geom_bar(stat = 'identity')+ geom_errorbar(aes(x = errorLevel,ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+facet_wrap(~expt+eml2)+scale_y_continuous(expand = c(0,0))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
errorLevel_eml2_levels = errorLevel_eml2 %>% group_by(expt,subject,eml2,errorLevel) %>% dplyr::summarise(prop = mean(prop), prop_corrected = mean(prop_corrected))
anova_test(data.frame(errorLevel_eml2_levels), dv = prop, wid = subject, between = expt, within = c(errorLevel, eml2), effect.size = 'pes')
anova_test(data.frame(errorLevel_eml2_levels), dv = prop_corrected, wid = subject, between = expt, within = c(errorLevel, eml2), effect.size = 'pes')

HL_errorLevel_eml2_levels = errorLevel_eml2_levels %>% filter(expt == 'hierDyn')
FL_errorLevel_eml2_levels = errorLevel_eml2_levels %>% filter(expt == 'flatDyn')
anova_test(data.frame(HL_errorLevel_eml2_levels), dv = prop, wid = subject,within = c(errorLevel, eml2), effect.size = 'pes')
anova_test(data.frame(FL_errorLevel_eml2_levels), dv = prop, wid = subject, within = c(errorLevel, eml2), effect.size = 'pes')
anova_test(data.frame(HL_errorLevel_eml2_levels), dv = prop_corrected, wid = subject,within = c(errorLevel, eml2), effect.size = 'pes')
anova_test(data.frame(FL_errorLevel_eml2_levels), dv = prop_corrected, wid = subject, within = c(errorLevel, eml2), effect.size = 'pes')
```
# top mid low level errors (corrected probabilities) ACROSS eml2
```{r, echo=F, message=F, warning=F, error=T,fig.width=6, fig.height=3, fig.align='center'}
compiledData_forced_trimmed$errorLevel = as.factor(compiledData_forced_trimmed$errorLevel)
errorLevel_expt= compiledData_forced_trimmed %>% filter(timing == 1,!is.na(errorType2)) %>% group_by(expt,subject,errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% filter(!is.na(errorLevel)) %>% group_by(expt,subject,.drop = FALSE) %>% dplyr::mutate(prop = counts/sum(counts))

errorLevel_expt$prop_corrected = errorLevel_expt$prop
errorLevel_expt$prop_corrected[errorLevel_expt$errorLevel == 'dtop'] = errorLevel_expt$prop_corrected[errorLevel_expt$errorLevel == 'dtop']/4
errorLevel_expt$prop_corrected[errorLevel_expt$errorLevel == 'cmid'] = errorLevel_expt$prop_corrected[errorLevel_expt$errorLevel == 'cmid']/2

errorLevel_expt_summary = summarySEwithin(errorLevel_expt, measurevar = 'prop_corrected',withinvars = c('errorLevel'),betweenvars = 'expt', idvar = 'subject', na.rm = TRUE)
errorLevel_expt_summary_HD = errorLevel_expt_summary %>% filter(expt == 'hierDyn')
errorLevel_expt_summary_FD = errorLevel_expt_summary %>% filter(expt == 'flatDyn')
errorLevel_expt_summary_nocorr = errorLevel_expt_summary %>% filter(errorLevel != 'acorr')
errorLevel_expt_nocorr = errorLevel_expt %>% filter(errorLevel != 'acorr')

ggplot(errorLevel_expt_summary_nocorr, aes(x =errorLevel,y = prop_corrected, group = errorLevel,fill = errorLevel)) + geom_bar(stat = 'identity')+ geom_errorbar(aes(x = errorLevel,ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+ geom_point(data = errorLevel_expt_nocorr, aes(x = errorLevel, y = prop_corrected),position = position_jitter(width = 0.1), alpha = 1)+
  facet_wrap(~expt)+scale_y_continuous(expand = c(0,0), limits = c(0,.2))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))


#ggsave('Dyn_errorLevel_nocorr_POINTS.eps')
ggplot(errorLevel_expt_summary_HD, aes(x =errorLevel,y = prop_corrected, group = errorLevel,fill = errorLevel)) + geom_bar(stat = 'identity')+ geom_errorbar(aes(x = errorLevel,ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+facet_wrap(~expt)+scale_y_continuous(expand = c(0,0))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

ggplot(errorLevel_expt_summary_FD, aes(x =errorLevel,y = prop_corrected, group = errorLevel,fill = errorLevel)) + geom_bar(stat = 'identity')+ geom_errorbar(aes(x = errorLevel,ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+facet_wrap(~expt)+scale_y_continuous(expand = c(0,0))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

errorLevel_expt_levels = errorLevel_expt %>% group_by(expt,subject,errorLevel) %>% dplyr::summarise(prop = mean(prop), prop_corrected = mean(prop_corrected))
anova_test(data.frame(errorLevel_expt_levels), dv = prop_corrected, wid = subject, between = expt, within = c(errorLevel), effect.size = 'pes')

HL_errorLevel_expt_levels = errorLevel_expt_levels %>% filter(expt == 'hierDyn')
FL_errorLevel_expt_levels = errorLevel_expt_levels %>% filter(expt == 'flatDyn')
anova_test(data.frame(HL_errorLevel_expt_levels), dv = prop_corrected, wid = subject,within = c(errorLevel), effect.size = 'pes')
anova_test(data.frame(FL_errorLevel_expt_levels), dv = prop_corrected, wid = subject, within = c(errorLevel), effect.size = 'pes')

errorLevel_expt_levels_errors = errorLevel_expt_levels %>% filter(errorLevel != 'acorr')
anova_test(data.frame(errorLevel_expt_levels_errors), dv = prop_corrected, wid = subject, between = expt, within = c(errorLevel), effect.size = 'pes')
errorLevel_across_aov = anova_test(data.frame(errorLevel_expt_levels_errors), dv = prop_corrected, wid = subject, between = expt, within = c(errorLevel), effect.size = 'pes')


HL_errorLevel_expt_levels_errors = errorLevel_expt_levels %>% filter(expt == 'hierDyn', errorLevel != 'acorr')
FL_errorLevel_expt_levels_errors= errorLevel_expt_levels %>% filter(expt == 'flatDyn', errorLevel != 'acorr')

anova_test(data.frame(HL_errorLevel_expt_levels_errors), dv = prop_corrected, wid = subject,within = c(errorLevel), effect.size = 'pes')
anova_test(data.frame(FL_errorLevel_expt_levels_errors), dv = prop_corrected, wid = subject, within = c(errorLevel), effect.size = 'pes')
ggplot(errorLevel_expt_levels_errors, aes(x = errorLevel, y= prop_corrected))+geom_bar(stat = 'summary',fun.y='mean')+geom_point()+facet_wrap(~expt)

t.test(FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'bbottom'],FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'cmid'], paired = TRUE)
cohen.d(FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'bbottom'],FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'cmid'],paired = TRUE)

t.test(FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'dtop'],FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'cmid'], paired = TRUE)
cohen.d(FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'dtop'],FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'cmid'],paired = TRUE)

t.test(FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'dtop'],FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'bbottom'], paired = TRUE)
cohen.d(FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'dtop'],FL_errorLevel_expt_levels_errors$prop_corrected[FL_errorLevel_expt_levels_errors$expt=='flatDyn' & FL_errorLevel_expt_levels_errors$errorLevel == 'bbottom'],paired = TRUE)


t.test(HL_errorLevel_expt_levels_errors$prop_corrected[HL_errorLevel_expt_levels_errors$expt=='hierDyn' & HL_errorLevel_expt_levels_errors$errorLevel == 'bbottom'],HL_errorLevel_expt_levels_errors$prop_corrected[HL_errorLevel_expt_levels_errors$expt=='hierDyn' & HL_errorLevel_expt_levels_errors$errorLevel == 'cmid'], paired = TRUE)
cohen.d(HL_errorLevel_expt_levels_errors$prop_corrected[HL_errorLevel_expt_levels_errors$expt=='hierDyn' & HL_errorLevel_expt_levels_errors$errorLevel == 'bbottom'],HL_errorLevel_expt_levels_errors$prop_corrected[HL_errorLevel_expt_levels_errors$expt=='hierDyn' & HL_errorLevel_expt_levels_errors$errorLevel == 'cmid'],paired = TRUE)

t.test(HL_errorLevel_expt_levels_errors$prop_corrected[HL_errorLevel_expt_levels_errors$expt=='hierDyn' & HL_errorLevel_expt_levels_errors$errorLevel == 'cmid'],HL_errorLevel_expt_levels_errors$prop_corrected[HL_errorLevel_expt_levels_errors$expt=='hierDyn' & HL_errorLevel_expt_levels_errors$errorLevel == 'dtop'], paired = TRUE)
cohen.d(HL_errorLevel_expt_levels_errors$prop_corrected[HL_errorLevel_expt_levels_errors$expt=='hierDyn' & HL_errorLevel_expt_levels_errors$errorLevel == 'dtop'],HL_errorLevel_expt_levels_errors$prop_corrected[HL_errorLevel_expt_levels_errors$expt=='hierDyn' & HL_errorLevel_expt_levels_errors$errorLevel == 'cmid'],paired = TRUE)

```

\newpage
# p(one-away error within-couplet) vs p(other adjacent error)
```{r, echo=F, message=F, warning=F, error=T,fig.width=4, fig.height=4, fig.align='center'}
oneaway = compiledData_forced_trimmed %>% group_by(expt, subject, corrCouplet,errorDiff) %>% filter(!(resp %in% c(1,4,5,8)),errorDiff == 1, timing == 1) %>% dplyr::summarise(counts = n()) %>% group_by(expt,subject, errorDiff.drop = FALSE) %>% dplyr::mutate(prop = counts/sum(counts))
oneaway_summary = summarySEwithin(oneaway,measurevar="prop", withinvars=c("corrCouplet"),between = "expt",idvar="subject", na.rm=FALSE, conf.interval=.95)

ggplot(oneaway_summary, aes(x = as.factor(corrCouplet), y = prop))+geom_bar(stat = 'summary', fun.y = 'mean')+geom_errorbar(aes(ymin=prop-se, ymax=prop+se), width=.2)+geom_point(data = oneaway, aes(x = as.factor(corrCouplet), y = prop),position = position_jitter(width = 0.1), alpha = 1)+
  facet_wrap(~expt)+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
    theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('oneawayError_errorbars_POINTS.eps')
oneaway_summary_hier = oneaway_summary %>% filter(expt == 'hierDyn')
oneaway_summary_flat = oneaway_summary %>% filter(expt == 'flatDyn')
t.test(oneaway$prop[oneaway$expt == 'hierDyn' & oneaway$corrCouplet == 0],oneaway$prop[oneaway$expt == 'hierDyn' & oneaway$corrCouplet == 1], paired = TRUE)
cohen.d(oneaway$prop[oneaway$expt == 'hierDyn' & oneaway$corrCouplet == 0],oneaway$prop[oneaway$expt == 'hierDyn' & oneaway$corrCouplet == 1],paired = TRUE)

t.test(oneaway$prop[oneaway$expt == 'flatDyn' & oneaway$corrCouplet == 0],oneaway$prop[oneaway$expt == 'flatDyn' & oneaway$corrCouplet == 1], paired = TRUE)
cohen.d(oneaway$prop[oneaway$expt == 'flatDyn' & oneaway$corrCouplet == 0],oneaway$prop[oneaway$expt == 'flatDyn' & oneaway$corrCouplet == 1],paired = TRUE)

ggplot(oneaway_summary_hier, aes(x = corrCouplet, y = prop))+geom_bar(stat = 'summary', fun.y = 'mean')+geom_errorbar(aes(ymin=prop-se, ymax=prop+se), width=.2)+
  scale_y_continuous(expand = c(0,0), limits = c(0,.65))+
    theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
ggplot(oneaway_summary_flat, aes(x = corrCouplet, y = prop))+geom_bar(stat = 'summary', fun.y = 'mean')+geom_errorbar(aes(ymin=prop-se, ymax=prop+se), width=.2)+
  scale_y_continuous(expand = c(0,0), limits = c(0,.65))+
    theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

```

# p(error for stim that share two features): low vs mid vs top 
```{r, echo=F, message=F, warning=F, error=T,fig.width=10, fig.height=4, fig.align='center'}
eml2errortype = compiledData_forced_trimmed %>% filter(timing == 1) %>% group_by(expt, subject, eml2,errorType2, .drop = FALSE) %>% dplyr::summarise(counts = n()) %>% mutate(prop = counts/sum(counts))
eml2errortype_two = eml2errortype %>% filter(errorType2 %in% c('1/1/0','1/0/1','0/1/1'))
eml2errortype_two_summary = summarySEwithin(eml2errortype_two,measurevar="prop", withinvars=c("errorType2"),between = "expt",idvar="subject", na.rm=FALSE, conf.interval=.95)
eml2errortype_noeml2 = compiledData_forced_trimmed %>% filter(timing == 1) %>% group_by(expt, subject,errorType2, .drop = FALSE) %>% dplyr::summarise(counts = n()) %>% mutate(prop = counts/sum(counts))
twofeat_aov = anova_test(data.frame(eml2errortype_noeml2), dv = prop, wid = subject, between = expt, within = c(errorType2), effect.size = 'pes')

eml2errortype_noeml2_two = eml2errortype_noeml2 %>% filter(errorType2 %in% c('1/1/0','1/0/1','0/1/1'))
eml2errortype_noeml2_two_HD = eml2errortype_noeml2 %>% filter(errorType2 %in% c('1/1/0','1/0/1','0/1/1'), expt == 'hierDyn')
eml2errortype_noeml2_two_FD = eml2errortype_noeml2 %>% filter(errorType2 %in% c('1/1/0','1/0/1','0/1/1'),expt == 'flatDyn')

eml2errortype_noeml2_two_summary_HD = summarySEwithin(eml2errortype_noeml2_two_HD,measurevar="prop", withinvars=c("errorType2"),idvar="subject", na.rm=TRUE, conf.interval=.95)
eml2errortype_noeml2_two_summary_FD = summarySEwithin(eml2errortype_noeml2_two_FD,measurevar="prop", withinvars=c("errorType2"),idvar="subject", na.rm=TRUE, conf.interval=.95)

ggplot(eml2errortype_noeml2_two_summary_HD, aes(x = errorType2, y = prop, fill = errorType2))+geom_bar(stat = 'identity')+geom_errorbar(aes(ymin=prop-se, ymax=prop+se), width=.2)+geom_point(data = eml2errortype_noeml2_two_HD, aes(x = errorType2, y = prop),position = position_jitter(width = 0.1), alpha = 1)+
  facet_wrap(~expt)+
  scale_y_continuous(expand = c(0,0), limits = c(0,.2))+
    theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('HD_matchtwofeatures_errorbars_POINTS.eps')

ggplot(eml2errortype_noeml2_two_summary_FD, aes(x = errorType2, y = prop, fill = errorType2))+geom_bar(stat = 'identity')+geom_errorbar(aes(ymin=prop-se, ymax=prop+se), width=.2)+geom_point(data = eml2errortype_noeml2_two_FD, aes(x = errorType2, y = prop),position = position_jitter(width = 0.1), alpha = 1)+
  facet_wrap(~expt)+
  scale_y_continuous(expand = c(0,0), limits = c(0,.2))+
    theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('FD_matchtwofeatures_errorbars_POINTS.eps')
eml2errortype_two_HL = eml2errortype_two_summary %>% filter(expt =='hierDyn')
eml2errortype_two_FL = eml2errortype_two_summary %>% filter(expt =='flatDyn')
ggplot(eml2errortype_two_HL, aes(x = errorType2, y = prop, fill = errorType2))+geom_bar(stat = 'identity')+geom_errorbar(aes(ymin=prop-se, ymax=prop+se), width=.2)+
  scale_y_continuous(expand = c(0,0), limits = c(0,.15))+
    theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

ggplot(eml2errortype_two_FL, aes(x = errorType2, y = prop, fill = errorType2))+geom_bar(stat = 'identity')+geom_errorbar(aes(ymin=prop-se, ymax=prop+se), width=.2)+
  scale_y_continuous(expand = c(0,0), limits = c(0,.15))+
    theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('expt6_twofeatureErrors.eps')
t.test(eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '1/1/0'],eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '1/0/1'],paired = TRUE)
cohen.d(eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '1/1/0'],eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '1/0/1'],paired = TRUE)
t.test(eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '1/0/1'],eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '0/1/1'],paired = TRUE)
cohen.d(eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '1/0/1'],eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '0/1/1'],paired = TRUE)
t.test(eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '1/1/0'],eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '0/1/1'],paired = TRUE)
cohen.d(eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '1/1/0'],eml2errortype_two$prop[eml2errortype_two$expt == 'hierDyn' & eml2errortype_two$errorType2 == '0/1/1'],paired = TRUE)

t.test(eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '1/1/0'],eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '1/0/1'],paired = TRUE)
cohen.d(eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '1/1/0'],eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '1/0/1'],paired = TRUE)
t.test(eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '1/0/1'],eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '0/1/1'],paired = TRUE)
cohen.d(eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '1/0/1'],eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '0/1/1'],paired = TRUE)
t.test(eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '1/1/0'],eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '0/1/1'],paired = TRUE)
cohen.d(eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '1/1/0'],eml2errortype_two$prop[eml2errortype_two$expt == 'flatDyn' & eml2errortype_two$errorType2 == '0/1/1'],paired = TRUE)
```

\newpage
# Forced-response results by distance
```{r, echo=F, message=F, warning=F, error=T, fig.width=5, fig.height=5, fig.align='center'}
accuDist = compiledData_forced_trimmed %>% filter(timing == 1,!is.na(treeDistance)) %>% group_by(expt, subject, treeDistance) %>% dplyr::summarise(accu = mean(corr, na.rm = TRUE))
anova_test(data.frame(accuDist), dv = accu, wid = subject, between = expt, within = c(treeDistance), effect.size = 'pes')

HL_accuDist = accuDist %>% filter(expt == 'hierDyn')
anova_test(data.frame(HL_accuDist), dv = accu, wid = subject, within = treeDistance, effect.size = 'pes')
t.test(HL_accuDist$accu[HL_accuDist$treeDistance == 6],HL_accuDist$accu[HL_accuDist$treeDistance == 4],paired = TRUE)
t.test(HL_accuDist$accu[HL_accuDist$treeDistance == 6],HL_accuDist$accu[HL_accuDist$treeDistance == 2],paired = TRUE)
t.test(HL_accuDist$accu[HL_accuDist$treeDistance == 6],HL_accuDist$accu[HL_accuDist$treeDistance ==0],paired = TRUE)
t.test(HL_accuDist$accu[HL_accuDist$treeDistance == 4],HL_accuDist$accu[HL_accuDist$treeDistance == 2],paired = TRUE)
t.test(HL_accuDist$accu[HL_accuDist$treeDistance == 4],HL_accuDist$accu[HL_accuDist$treeDistance == 0],paired = TRUE)
t.test(HL_accuDist$accu[HL_accuDist$treeDistance == 2],HL_accuDist$accu[HL_accuDist$treeDistance == 0],paired = TRUE)

HL_accuDist_summaryStats =  summarySEwithin(HL_accuDist,measurevar="accu", withinvars=c("treeDistance"),idvar="subject", na.rm=FALSE, conf.interval=.95)
ggplot(HL_accuDist_summaryStats, aes(x = as.factor(treeDistance), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'RT')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('Expt5_accuxdist.eps')

FL_accuDist = accuDist %>% filter(expt == 'flatDyn')
anova_test(data.frame(FL_accuDist), dv = accu, wid = subject, within = treeDistance, effect.size = 'pes')
t.test(FL_accuDist$accu[FL_accuDist$treeDistance == 6],FL_accuDist$accu[FL_accuDist$treeDistance == 4],paired = TRUE)
t.test(FL_accuDist$accu[FL_accuDist$treeDistance == 6],FL_accuDist$accu[FL_accuDist$treeDistance == 2],paired = TRUE)
t.test(FL_accuDist$accu[FL_accuDist$treeDistance == 6],FL_accuDist$accu[FL_accuDist$treeDistance == 0],paired = TRUE)
t.test(FL_accuDist$accu[FL_accuDist$treeDistance == 4],FL_accuDist$accu[FL_accuDist$treeDistance == 2],paired = TRUE)
t.test(FL_accuDist$accu[FL_accuDist$treeDistance == 4],FL_accuDist$accu[FL_accuDist$treeDistance == 0],paired = TRUE)
t.test(FL_accuDist$accu[FL_accuDist$treeDistance == 2],FL_accuDist$accu[FL_accuDist$treeDistance == 0],paired = TRUE)

FL_accuDist_summaryStats =  summarySEwithin(FL_accuDist,measurevar="accu", withinvars=c("treeDistance"),idvar="subject", na.rm=FALSE, conf.interval=.95)
ggplot(FL_accuDist_summaryStats, aes(x = as.factor(treeDistance), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'RT')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('Expt6_accuxdist.eps')

```
# accuracy by distance and binned PT (~400ms bins)
```{r, echo=F, message=F, warning=F, error=T, fig.width=3, fig.height=3, fig.align='center'}
accuDist_eml = compiledData_forced_trimmed %>% filter(timing == 1,!is.na(treeDistance)) %>% group_by(expt, subject, eml2, treeDistance) %>% dplyr::summarise(accu = mean(corr, na.rm = TRUE))
HL_accuDist_eml = accuDist_eml %>% filter(expt == 'hierDyn')
FL_accuDist_eml = accuDist_eml %>% filter(expt == 'flatDyn')

anova_test(data.frame(accuDist_eml), dv = accu, wid = subject, between = expt, within = c(treeDistance, eml2), effect.size = 'pes')
anova_test(data.frame(HL_accuDist_eml), dv = accu, wid = subject, within = c(treeDistance, eml2), effect.size = 'pes')
anova_test(data.frame(FL_accuDist_eml), dv = accu, wid = subject, within = c(treeDistance, eml2), effect.size = 'pes')

HL_accuDist_eml$version = 'hl'
HL_accuDist_eml2_summaryStats =  summarySEwithin(HL_accuDist_eml,measurevar="accu", withinvars=c("treeDistance", "eml2"),idvar="subject", na.rm=FALSE, conf.interval=.95)
ggplot(HL_accuDist_eml2_summaryStats, aes(x = as.factor(treeDistance), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'accuracy')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))+facet_wrap(~eml2)
#ggsave('Expt5_accuxdistxeml2.eps')
FL_accuDist_eml2_summaryStats =  summarySEwithin(FL_accuDist_eml,measurevar="accu", withinvars=c("treeDistance", "eml2"),idvar="subject", na.rm=FALSE, conf.interval=.95)
ggplot(FL_accuDist_eml2_summaryStats, aes(x = as.factor(treeDistance), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'accuracy')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))+facet_wrap(~eml2)
#ggsave('Expt6_accuxdistxeml2.eps')


```

# Forced-response results by distance
```{r, echo=F, message=F, warning=F, error=T, fig.width=5, fig.height=5, fig.align='center'}
accuDist_stim = compiledData_forced_trimmed %>% filter(timing == 1,!is.na(treeDistance_stim)) %>% group_by(expt, subject, treeDistance_stim) %>% dplyr::summarise(accu = mean(corr, na.rm = TRUE))
anova_test(data.frame(accuDist_stim), dv = accu, wid = subject, between = expt, within = c(treeDistance_stim), effect.size = 'pes')

HL_accuDist_stim = accuDist_stim %>% filter(expt == 'hierDyn')
anova_test(data.frame(HL_accuDist_stim), dv = accu, wid = subject, within = treeDistance_stim, effect.size = 'pes')
t.test(HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 6],HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 4],paired = TRUE)
t.test(HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 6],HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 2],paired = TRUE)
t.test(HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 6],HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim ==0],paired = TRUE)
t.test(HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 4],HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 2],paired = TRUE)
t.test(HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 4],HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 0],paired = TRUE)
t.test(HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 2],HL_accuDist_stim$accu[HL_accuDist_stim$treeDistance_stim == 0],paired = TRUE)

HL_accuDist_stim_summaryStats =  summarySEwithin(HL_accuDist_stim,measurevar="accu", withinvars=c("treeDistance_stim"),idvar="subject", na.rm=FALSE, conf.interval=.95)
ggplot(HL_accuDist_stim_summaryStats, aes(x = as.factor(treeDistance_stim), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'accuracy')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('Expt5_accuxdist.eps')

FL_accuDist_stim = accuDist_stim %>% filter(expt == 'flatDyn')
anova_test(data.frame(FL_accuDist_stim), dv = accu, wid = subject, within = treeDistance_stim, effect.size = 'pes')
t.test(FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 6],FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 4],paired = TRUE)
t.test(FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 6],FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 2],paired = TRUE)
t.test(FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 6],FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 0],paired = TRUE)
t.test(FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 4],FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 2],paired = TRUE)
t.test(FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 4],FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 0],paired = TRUE)
t.test(FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 2],FL_accuDist_stim$accu[FL_accuDist_stim$treeDistance_stim == 0],paired = TRUE)

FL_accuDist_stim_summaryStats =  summarySEwithin(FL_accuDist_stim,measurevar="accu", withinvars=c("treeDistance_stim"),idvar="subject", na.rm=FALSE, conf.interval=.95)
ggplot(FL_accuDist_stim_summaryStats, aes(x = as.factor(treeDistance_stim), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  labs(x= 'tree distance', y = 'accuracy')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('Expt6_accuxdist.eps')

```
# accuracy by distance and binned PT (~400ms bins)
```{r, echo=F, message=F, warning=F, error=T, fig.width=3, fig.height=3, fig.align='center'}
accuDist_stim_eml = compiledData_forced_trimmed %>% filter(timing == 1,!is.na(treeDistance_stim)) %>% group_by(expt, subject, eml2, treeDistance_stim) %>% dplyr::summarise(accu = mean(corr, na.rm = TRUE))
HL_accuDist_stim_eml = accuDist_stim_eml %>% filter(expt == 'hierDyn')
FL_accuDist_stim_eml = accuDist_stim_eml %>% filter(expt == 'flatDyn')

accuDist_eml_aov = anova_test(data.frame(accuDist_stim_eml), dv = accu, wid = subject, between = expt, within = c(treeDistance_stim, eml2), effect.size = 'pes')

anova_test(data.frame(HL_accuDist_stim_eml), dv = accu, wid = subject, within = c(treeDistance_stim, eml2), effect.size = 'pes')
anova_test(data.frame(FL_accuDist_stim_eml), dv = accu, wid = subject, within = c(treeDistance_stim, eml2), effect.size = 'pes')

HL_accuDist_stim_eml$version = 'hl'
HL_accuDist_stim_eml2_summaryStats =  summarySEwithin(HL_accuDist_stim_eml,measurevar="accu", withinvars=c("treeDistance_stim", "eml2"),idvar="subject", na.rm=FALSE, conf.interval=.95)
ggplot(HL_accuDist_stim_eml2_summaryStats, aes(x = as.factor(treeDistance_stim), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  geom_point(data = HL_accuDist_stim_eml, aes(x = as.factor(treeDistance_stim), y = accu),position = position_jitter(width = 0.1), alpha = 1)+
  labs(x= 'tree distance', y = 'accuracy')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))+facet_wrap(~eml2)
ggsave('Expt5_accuxdistxeml2_POINTS.eps')
FL_accuDist_stim_eml2_summaryStats =  summarySEwithin(FL_accuDist_stim_eml,measurevar="accu", withinvars=c("treeDistance_stim", "eml2"),idvar="subject", na.rm=FALSE, conf.interval=.95)
ggplot(FL_accuDist_stim_eml2_summaryStats, aes(x = as.factor(treeDistance_stim), y = accu)) + 
  geom_bar(stat = "identity",position = "dodge")+
  geom_errorbar(aes(ymin=accu-se, ymax=accu+se), width=.2,position=position_dodge(.9))+
  geom_point(data = FL_accuDist_stim_eml, aes(x = as.factor(treeDistance_stim), y = accu),position = position_jitter(width = 0.1), alpha = 1)+
  labs(x= 'tree distance', y = 'accuracy')+
  scale_y_continuous(expand = c(0,0), limits = c(0,1))+
  theme(panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize), 
        axis.title.x = element_text(size = axisTitleSize), 
        axis.title.y = element_text(size = axisTitleSize), 
        axis.text.x = element_text(size = axisTextSize, color = textColor), 
        axis.text.y = element_text(size = axisTextSize, color = textColor), 
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))+facet_wrap(~eml2)
ggsave('Expt6_accuxdistxeml2_POINTS.eps')
```
# Smoothed curves for across PT bins by error type
```{r, echo=F, message=F, warning=F, error=T, fig.width=9, fig.height=6, fig.align='center'}
# set up the timepoints
minTime = min(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
maxTime = max(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
step = .01
win = .05
timepoints = seq(0,maxTime,step)
compiledData_forced_trimmed$treeDistance_stim = as.factor(compiledData_forced_trimmed$treeDistance_stim)
# set up the dataframe
HL_smoothedData_treeDistance_stim = data.frame(matrix(NA, ncol = 6,nrow = length(timepoints)*length(subjNums_hierDyn)))
colnames(HL_smoothedData_treeDistance_stim) = c('subject','tp', 'six', 'four','two','zero')

hierDyn_forced_timing = compiledData_forced_trimmed %>% filter(!is.na(treeDistance_stim), expt == 'hierDyn', timing == 1)
for(si in 1:length(subjNums_hierDyn)){
  subjData = hierDyn_forced_timing %>% filter(subject == subjNums_hierDyn[si])
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_treeDistance_stim$subject[ti+(length(timepoints)*(si-1))] = subjNums_hierDyn[si]
    HL_smoothedData_treeDistance_stim$tp[ti+(length(timepoints)*(si-1))] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(subjData$PT_actual > (timepoints[ti]-win) & subjData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = subjData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_treeDistance_stim = HL_relData %>% group_by(treeDistance_stim, .drop = FALSE) %>% dplyr::summarize(accu = mean(corr, na.rm = TRUE))
      HL_smoothedData_treeDistance_stim$six[ti+(length(timepoints)*(si-1))] = HL_relData_treeDistance_stim$accu[HL_relData_treeDistance_stim$treeDistance_stim == 6]
      HL_smoothedData_treeDistance_stim$four[ti+(length(timepoints)*(si-1))]= HL_relData_treeDistance_stim$accu[HL_relData_treeDistance_stim$treeDistance_stim == 4]
      HL_smoothedData_treeDistance_stim$two[ti+(length(timepoints)*(si-1))]= HL_relData_treeDistance_stim$accu[HL_relData_treeDistance_stim$treeDistance_stim == 2]
      HL_smoothedData_treeDistance_stim$zero[ti+(length(timepoints)*(si-1))] = HL_relData_treeDistance_stim$accu[HL_relData_treeDistance_stim$treeDistance_stim == 0]
      }
    }
}

HL_smoothedData_treeDistance_stim = pivot_longer(HL_smoothedData_treeDistance_stim, c(six,four,two,zero), names_to = 'treeDistance_stim', values_to = 'accu')
HL_smoothedData_treeDistance_stim$subject=as.factor(HL_smoothedData_treeDistance_stim$subject)
HL_smoothedData_treeDistance_stim$treeDistance_stim = as.factor(HL_smoothedData_treeDistance_stim$treeDistance_stim)
HL_smoothedData_treeDistance_stim$treeDistance_stim_num = NA
HL_smoothedData_treeDistance_stim$treeDistance_stim_num[HL_smoothedData_treeDistance_stim$treeDistance_stim == 'six'] = 6
HL_smoothedData_treeDistance_stim$treeDistance_stim_num[HL_smoothedData_treeDistance_stim$treeDistance_stim == 'four'] = 4
HL_smoothedData_treeDistance_stim$treeDistance_stim_num[HL_smoothedData_treeDistance_stim$treeDistance_stim == 'two'] = 2
HL_smoothedData_treeDistance_stim$treeDistance_stim_num[HL_smoothedData_treeDistance_stim$treeDistance_stim == 'zero'] = 0
HL_smoothedData_treeDistance_stim$tp = as.numeric(HL_smoothedData_treeDistance_stim$tp)

HL_smoothedData_treeDistance_stim_plotting = HL_smoothedData_treeDistance_stim %>% group_by(subject, treeDistance_stim, .drop = FALSE) 
HL_smoothedData_treeDistance_stim_all_summary = summarySEwithin(HL_smoothedData_treeDistance_stim, measurevar = 'accu',withinvars = c('tp','treeDistance_stim'), idvar = 'subject', na.rm = TRUE)

HL_smoothedData_treeDistance_stim_all_summary$tp[which(HL_smoothedData_treeDistance_stim_all_summary$tp == '1.3'):length(HL_smoothedData_treeDistance_stim_all_summary$tp)] = NA

######## FLAT ##########
FL_smoothedData_treeDistance_stim = data.frame(matrix(NA, ncol = 6,nrow = length(timepoints)*length(subjNums_flatDyn)))
colnames(FL_smoothedData_treeDistance_stim) = c('subject','tp', 'six', 'four','two','zero')

flatDyn_forced_timing = compiledData_forced_trimmed %>% filter(!is.na(treeDistance_stim), expt == 'flatDyn', timing == 1)
for(si in 1:length(subjNums_flatDyn)){
  subjData = flatDyn_forced_timing %>% filter(subject == subjNums_flatDyn[si])
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_treeDistance_stim$subject[ti+(length(timepoints)*(si-1))] = subjNums_flatDyn[si]
    FL_smoothedData_treeDistance_stim$tp[ti+(length(timepoints)*(si-1))] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(subjData$PT_actual > (timepoints[ti]-win) & subjData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = subjData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_treeDistance_stim = FL_relData %>% group_by(treeDistance_stim, .drop = FALSE) %>% dplyr::summarize(accu = mean(corr, na.rm = TRUE))
      FL_smoothedData_treeDistance_stim$six[ti+(length(timepoints)*(si-1))] = FL_relData_treeDistance_stim$accu[FL_relData_treeDistance_stim$treeDistance_stim == 6]
      FL_smoothedData_treeDistance_stim$four[ti+(length(timepoints)*(si-1))]= FL_relData_treeDistance_stim$accu[FL_relData_treeDistance_stim$treeDistance_stim == 4]
      FL_smoothedData_treeDistance_stim$two[ti+(length(timepoints)*(si-1))]= FL_relData_treeDistance_stim$accu[FL_relData_treeDistance_stim$treeDistance_stim == 2]
      FL_smoothedData_treeDistance_stim$zero[ti+(length(timepoints)*(si-1))] = FL_relData_treeDistance_stim$accu[FL_relData_treeDistance_stim$treeDistance_stim == 0]
      }
    }
}

FL_smoothedData_treeDistance_stim = pivot_longer(FL_smoothedData_treeDistance_stim, c(six,four,two,zero), names_to = 'treeDistance_stim', values_to = 'accu')
FL_smoothedData_treeDistance_stim$subject=as.factor(FL_smoothedData_treeDistance_stim$subject)
FL_smoothedData_treeDistance_stim$treeDistance_stim = as.factor(FL_smoothedData_treeDistance_stim$treeDistance_stim)
FL_smoothedData_treeDistance_stim$treeDistance_stim_num = NA
FL_smoothedData_treeDistance_stim$treeDistance_stim_num[FL_smoothedData_treeDistance_stim$treeDistance_stim == 'six'] = 6
FL_smoothedData_treeDistance_stim$treeDistance_stim_num[FL_smoothedData_treeDistance_stim$treeDistance_stim == 'four'] = 4
FL_smoothedData_treeDistance_stim$treeDistance_stim_num[FL_smoothedData_treeDistance_stim$treeDistance_stim == 'two'] = 2
FL_smoothedData_treeDistance_stim$treeDistance_stim_num[FL_smoothedData_treeDistance_stim$treeDistance_stim == 'zero'] = 0
FL_smoothedData_treeDistance_stim$tp = as.numeric(FL_smoothedData_treeDistance_stim$tp)

FL_smoothedData_treeDistance_stim_plotting = FL_smoothedData_treeDistance_stim %>% group_by(subject, treeDistance_stim, .drop = FALSE) 
FL_smoothedData_treeDistance_stim_all_summary = summarySEwithin(FL_smoothedData_treeDistance_stim, measurevar = 'accu',withinvars = c('tp','treeDistance_stim'), idvar = 'subject', na.rm = TRUE)

FL_smoothedData_treeDistance_stim_all_summary$tp[which(FL_smoothedData_treeDistance_stim_all_summary$tp == '1.3'):length(FL_smoothedData_treeDistance_stim_all_summary$tp)] = NA

# plot nicely
HL_smoothedData_treeDistance_stim_all_summary_trimmed = HL_smoothedData_treeDistance_stim_all_summary %>% filter(tp %in% seq(.1,1.2,step))
FL_smoothedData_treeDistance_stim_all_summary_trimmed = FL_smoothedData_treeDistance_stim_all_summary %>% filter(tp %in% seq(.1,1.2,step))

ggplot(HL_smoothedData_treeDistance_stim_all_summary_trimmed, aes(x =tp,y = accu, group = treeDistance_stim,color = treeDistance_stim)) + geom_line()+geom_ribbon(data=HL_smoothedData_treeDistance_stim_all_summary_trimmed,aes(x = tp,ymin = accu - se, ymax = accu + se, fill = treeDistance_stim), inherit.aes = TRUE, alpha = 1)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#ggsave('hltreeDistance_stimxpt.eps')


ggplot(FL_smoothedData_treeDistance_stim_all_summary_trimmed, aes(x =tp,y = accu, group = treeDistance_stim,color = treeDistance_stim)) + geom_line()+geom_ribbon(data=FL_smoothedData_treeDistance_stim_all_summary_trimmed,aes(x = tp,ymin = accu - se, ymax = accu + se, fill = treeDistance_stim), inherit.aes = TRUE, alpha = 1)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('fltreeDistance_stimxpt.eps')
```
# Smoothed curves for across PT bins by error type
```{r, echo=F, message=F, warning=F, error=T, fig.width=9, fig.height=6, fig.align='center'}
# set up the timepoints
minTime = min(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
maxTime = max(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
step = .01
win = .05
timepoints = seq(0,maxTime,step)

# set up the dataframe
HL_smoothedData_treeDistance = data.frame(matrix(NA, ncol = 6,nrow = length(timepoints)*length(subjNums_hierDyn)))
colnames(HL_smoothedData_treeDistance) = c('subject','tp', 'six', 'four','two','zero')

hierDyn_forced_timing = compiledData_forced_trimmed %>% filter(!is.na(treeDistance_factor), expt == 'hierDyn', timing_chill == 1)
for(si in 1:length(subjNums_hierDyn)){
  subjData = hierDyn_forced_timing %>% filter(subject == subjNums_hierDyn[si])
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_treeDistance$subject[ti+(length(timepoints)*(si-1))] = subjNums_hierDyn[si]
    HL_smoothedData_treeDistance$tp[ti+(length(timepoints)*(si-1))] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(subjData$PT_actual > (timepoints[ti]-win) & subjData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = subjData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_treeDistance_factor = HL_relData %>% group_by(treeDistance_factor, .drop = FALSE) %>% dplyr::summarize(accu = mean(corr, na.rm = TRUE))
      HL_smoothedData_treeDistance$six[ti+(length(timepoints)*(si-1))] = HL_relData_treeDistance_factor$accu[HL_relData_treeDistance_factor$treeDistance_factor == 6]
      HL_smoothedData_treeDistance$four[ti+(length(timepoints)*(si-1))]= HL_relData_treeDistance_factor$accu[HL_relData_treeDistance_factor$treeDistance_factor == 4]
      HL_smoothedData_treeDistance$two[ti+(length(timepoints)*(si-1))]= HL_relData_treeDistance_factor$accu[HL_relData_treeDistance_factor$treeDistance_factor == 2]
      HL_smoothedData_treeDistance$zero[ti+(length(timepoints)*(si-1))] = HL_relData_treeDistance_factor$accu[HL_relData_treeDistance_factor$treeDistance_factor == 0]
      }
    }
}

HL_smoothedData_treeDistance = pivot_longer(HL_smoothedData_treeDistance, c(six,four,two,zero), names_to = 'treeDistance', values_to = 'accu')
HL_smoothedData_treeDistance$subject=as.factor(HL_smoothedData_treeDistance$subject)
HL_smoothedData_treeDistance$treeDistance = as.factor(HL_smoothedData_treeDistance$treeDistance)
HL_smoothedData_treeDistance$treeDistance_num = NA
HL_smoothedData_treeDistance$treeDistance_num[HL_smoothedData_treeDistance$treeDistance == 'six'] = 6
HL_smoothedData_treeDistance$treeDistance_num[HL_smoothedData_treeDistance$treeDistance == 'four'] = 4
HL_smoothedData_treeDistance$treeDistance_num[HL_smoothedData_treeDistance$treeDistance == 'two'] = 2
HL_smoothedData_treeDistance$treeDistance_num[HL_smoothedData_treeDistance$treeDistance == 'zero'] = 0
HL_smoothedData_treeDistance$tp = as.numeric(HL_smoothedData_treeDistance$tp)

HL_smoothedData_treeDistance_plotting = HL_smoothedData_treeDistance %>% group_by(subject, treeDistance, .drop = FALSE) 
HL_smoothedData_treeDistance_all_summary = summarySEwithin(HL_smoothedData_treeDistance, measurevar = 'accu',withinvars = c('tp','treeDistance'), idvar = 'subject', na.rm = TRUE)

HL_smoothedData_treeDistance_all_summary$tp[which(HL_smoothedData_treeDistance_all_summary$tp == '1.3'):length(HL_smoothedData_treeDistance_all_summary$tp)] = NA

######## FLAT ##########
FL_smoothedData_treeDistance = data.frame(matrix(NA, ncol = 6,nrow = length(timepoints)*length(subjNums_flatDyn)))
colnames(FL_smoothedData_treeDistance) = c('subject','tp', 'six', 'four','two','zero')

flatDyn_forced_timing = compiledData_forced_trimmed %>% filter(!is.na(treeDistance_factor), expt == 'flatDyn', timing == 1)
for(si in 1:length(subjNums_flatDyn)){
  subjData = flatDyn_forced_timing %>% filter(subject == subjNums_flatDyn[si])
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_treeDistance$subject[ti+(length(timepoints)*(si-1))] = subjNums_flatDyn[si]
    FL_smoothedData_treeDistance$tp[ti+(length(timepoints)*(si-1))] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(subjData$PT_actual > (timepoints[ti]-win) & subjData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = subjData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_treeDistance_factor = FL_relData %>% group_by(treeDistance_factor, .drop = FALSE) %>% dplyr::summarize(accu = mean(corr, na.rm = TRUE))
      FL_smoothedData_treeDistance$six[ti+(length(timepoints)*(si-1))] = FL_relData_treeDistance_factor$accu[FL_relData_treeDistance_factor$treeDistance_factor == 6]
      FL_smoothedData_treeDistance$four[ti+(length(timepoints)*(si-1))]= FL_relData_treeDistance_factor$accu[FL_relData_treeDistance_factor$treeDistance_factor == 4]
      FL_smoothedData_treeDistance$two[ti+(length(timepoints)*(si-1))]= FL_relData_treeDistance_factor$accu[FL_relData_treeDistance_factor$treeDistance_factor == 2]
      FL_smoothedData_treeDistance$zero[ti+(length(timepoints)*(si-1))] = FL_relData_treeDistance_factor$accu[FL_relData_treeDistance_factor$treeDistance_factor == 0]
      }
    }
}

FL_smoothedData_treeDistance = pivot_longer(FL_smoothedData_treeDistance, c(six,four,two,zero), names_to = 'treeDistance', values_to = 'accu')
FL_smoothedData_treeDistance$subject=as.factor(FL_smoothedData_treeDistance$subject)
FL_smoothedData_treeDistance$treeDistance = as.factor(FL_smoothedData_treeDistance$treeDistance)
FL_smoothedData_treeDistance$treeDistance_num = NA
FL_smoothedData_treeDistance$treeDistance_num[FL_smoothedData_treeDistance$treeDistance == 'six'] = 6
FL_smoothedData_treeDistance$treeDistance_num[FL_smoothedData_treeDistance$treeDistance == 'four'] = 4
FL_smoothedData_treeDistance$treeDistance_num[FL_smoothedData_treeDistance$treeDistance == 'two'] = 2
FL_smoothedData_treeDistance$treeDistance_num[FL_smoothedData_treeDistance$treeDistance == 'zero'] = 0
FL_smoothedData_treeDistance$tp = as.numeric(FL_smoothedData_treeDistance$tp)

FL_smoothedData_treeDistance_plotting = FL_smoothedData_treeDistance %>% group_by(subject, treeDistance, .drop = FALSE) 
FL_smoothedData_treeDistance_all_summary = summarySEwithin(FL_smoothedData_treeDistance, measurevar = 'accu',withinvars = c('tp','treeDistance'), idvar = 'subject', na.rm = TRUE)

FL_smoothedData_treeDistance_all_summary$tp[which(FL_smoothedData_treeDistance_all_summary$tp == '1.3'):length(FL_smoothedData_treeDistance_all_summary$tp)] = NA

# plot nicely
HL_smoothedData_treeDistance_all_summary_trimmed = HL_smoothedData_treeDistance_all_summary %>% filter(tp %in% seq(.1,1.2,step))
FL_smoothedData_treeDistance_all_summary_trimmed = FL_smoothedData_treeDistance_all_summary %>% filter(tp %in% seq(.1,1.2,step))

ggplot(HL_smoothedData_treeDistance_all_summary_trimmed, aes(x =tp,y = accu, group = treeDistance,color = treeDistance)) + geom_line()+geom_ribbon(data=HL_smoothedData_treeDistance_all_summary_trimmed,aes(x = tp,ymin = accu - se, ymax = accu + se, fill = treeDistance), inherit.aes = TRUE, alpha = 1)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('hltreedistancexpt.eps')


ggplot(FL_smoothedData_treeDistance_all_summary_trimmed, aes(x =tp,y = accu, group = treeDistance,color = treeDistance)) + geom_line()+geom_ribbon(data=FL_smoothedData_treeDistance_all_summary_trimmed,aes(x = tp,ymin = accu - se, ymax = accu + se, fill = treeDistance), inherit.aes = TRUE, alpha = 1)+scale_x_discrete(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('fltreedistancexpt.eps')
```
# SUPER-SUBJECT: Experiment 5, P(response type) x PT (all 8 response types) x path distance
```{r, echo=F, message=F, warning=F, error=T, fig.width=4, fig.height=3, fig.align='center'}
minTime = min(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
maxTime = max(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
step = .01
win = .05
timepoints = seq(0,maxTime,step)

# HIERDYN
#### SIX #####
HL_smoothedData_errorType2_six = data.frame(matrix(NA, ncol = 9,nrow = length(timepoints)*1))
colnames(HL_smoothedData_errorType2_six) = c('tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

sixData = compiledData_forced_trimmed %>% filter(expt == 'hierDyn',treeDistance == 6,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorType2_six$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(sixData$PT_actual > (timepoints[ti]-win) & sixData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = sixData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorType2 = HL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorType2_six$zerozerozero[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/0']
      HL_smoothedData_errorType2_six$zerozeroone[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/1']
      HL_smoothedData_errorType2_six$zeroonezero[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/0']
      HL_smoothedData_errorType2_six$zerooneone[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/1']
      
      HL_smoothedData_errorType2_six$onezerozero[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/0']
      HL_smoothedData_errorType2_six$onezeroone[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/1']
      HL_smoothedData_errorType2_six$oneonezero[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/0']
      HL_smoothedData_errorType2_six$oneoneone[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/1']
      }
    }

HL_smoothedData_errorType2_six = pivot_longer(HL_smoothedData_errorType2_six, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
HL_smoothedData_errorType2_six$errorType2 = as.factor(HL_smoothedData_errorType2_six$errorType2)
HL_smoothedData_errorType2_six$errorType2_num = NA
HL_smoothedData_errorType2_six$errorType2_num[HL_smoothedData_errorType2_six$errorType2 == 'oneoneone'] = '1/1/1'
HL_smoothedData_errorType2_six$errorType2_num[HL_smoothedData_errorType2_six$errorType2 == 'oneonezero'] = '1/1/0'
HL_smoothedData_errorType2_six$errorType2_num[HL_smoothedData_errorType2_six$errorType2 == 'onezeroone'] = '1/0/1'
HL_smoothedData_errorType2_six$errorType2_num[HL_smoothedData_errorType2_six$errorType2 == 'onezerozero'] = '1/0/0'

HL_smoothedData_errorType2_six$errorType2_num[HL_smoothedData_errorType2_six$errorType2 == 'zerooneone'] = '0/1/1'
HL_smoothedData_errorType2_six$errorType2_num[HL_smoothedData_errorType2_six$errorType2 == 'zeroonezero'] = '0/1/0'
HL_smoothedData_errorType2_six$errorType2_num[HL_smoothedData_errorType2_six$errorType2 == 'zerozeroone'] = '0/0/1'
HL_smoothedData_errorType2_six$errorType2_num[HL_smoothedData_errorType2_six$errorType2 == 'zerozerozero'] = '0/0/0'
HL_smoothedData_errorType2_six$tp = as.numeric(HL_smoothedData_errorType2_six$tp)

# PLOT Experiment 5
HL_smoothedData_errorType2_six_plotting_trimmed = HL_smoothedData_errorType2_six %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorType2_six_plotting_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### four #####
HL_smoothedData_errorType2_four = data.frame(matrix(NA, ncol = 9,nrow = length(timepoints)*1))
colnames(HL_smoothedData_errorType2_four) = c('tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

fourData = compiledData_forced_trimmed %>% filter(expt == 'hierDyn',treeDistance == 4,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorType2_four$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(fourData$PT_actual > (timepoints[ti]-win) & fourData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = fourData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorType2 = HL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorType2_four$zerozerozero[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/0']
      HL_smoothedData_errorType2_four$zerozeroone[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/1']
      HL_smoothedData_errorType2_four$zeroonezero[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/0']
      HL_smoothedData_errorType2_four$zerooneone[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/1']
      
      HL_smoothedData_errorType2_four$onezerozero[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/0']
      HL_smoothedData_errorType2_four$onezeroone[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/1']
      HL_smoothedData_errorType2_four$oneonezero[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/0']
      HL_smoothedData_errorType2_four$oneoneone[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/1']
      }
    }

HL_smoothedData_errorType2_four = pivot_longer(HL_smoothedData_errorType2_four, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
HL_smoothedData_errorType2_four$errorType2 = as.factor(HL_smoothedData_errorType2_four$errorType2)
HL_smoothedData_errorType2_four$errorType2_num = NA
HL_smoothedData_errorType2_four$errorType2_num[HL_smoothedData_errorType2_four$errorType2 == 'oneoneone'] = '1/1/1'
HL_smoothedData_errorType2_four$errorType2_num[HL_smoothedData_errorType2_four$errorType2 == 'oneonezero'] = '1/1/0'
HL_smoothedData_errorType2_four$errorType2_num[HL_smoothedData_errorType2_four$errorType2 == 'onezeroone'] = '1/0/1'
HL_smoothedData_errorType2_four$errorType2_num[HL_smoothedData_errorType2_four$errorType2 == 'onezerozero'] = '1/0/0'

HL_smoothedData_errorType2_four$errorType2_num[HL_smoothedData_errorType2_four$errorType2 == 'zerooneone'] = '0/1/1'
HL_smoothedData_errorType2_four$errorType2_num[HL_smoothedData_errorType2_four$errorType2 == 'zeroonezero'] = '0/1/0'
HL_smoothedData_errorType2_four$errorType2_num[HL_smoothedData_errorType2_four$errorType2 == 'zerozeroone'] = '0/0/1'
HL_smoothedData_errorType2_four$errorType2_num[HL_smoothedData_errorType2_four$errorType2 == 'zerozerozero'] = '0/0/0'
HL_smoothedData_errorType2_four$tp = as.numeric(HL_smoothedData_errorType2_four$tp)

# PLOT Experiment 5
HL_smoothedData_errorType2_four_plotting_trimmed = HL_smoothedData_errorType2_four %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorType2_four_plotting_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### two #####
HL_smoothedData_errorType2_two = data.frame(matrix(NA, ncol = 9,nrow = length(timepoints)*1))
colnames(HL_smoothedData_errorType2_two) = c('tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

twoData = compiledData_forced_trimmed %>% filter(expt == 'hierDyn',treeDistance == 2,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorType2_two$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(twoData$PT_actual > (timepoints[ti]-win) & twoData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = twoData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorType2 = HL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorType2_two$zerozerozero[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/0']
      HL_smoothedData_errorType2_two$zerozeroone[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/1']
      HL_smoothedData_errorType2_two$zeroonezero[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/0']
      HL_smoothedData_errorType2_two$zerooneone[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/1']
      
      HL_smoothedData_errorType2_two$onezerozero[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/0']
      HL_smoothedData_errorType2_two$onezeroone[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/1']
      HL_smoothedData_errorType2_two$oneonezero[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/0']
      HL_smoothedData_errorType2_two$oneoneone[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/1']
      }
    }

HL_smoothedData_errorType2_two = pivot_longer(HL_smoothedData_errorType2_two, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
HL_smoothedData_errorType2_two$errorType2 = as.factor(HL_smoothedData_errorType2_two$errorType2)
HL_smoothedData_errorType2_two$errorType2_num = NA
HL_smoothedData_errorType2_two$errorType2_num[HL_smoothedData_errorType2_two$errorType2 == 'oneoneone'] = '1/1/1'
HL_smoothedData_errorType2_two$errorType2_num[HL_smoothedData_errorType2_two$errorType2 == 'oneonezero'] = '1/1/0'
HL_smoothedData_errorType2_two$errorType2_num[HL_smoothedData_errorType2_two$errorType2 == 'onezeroone'] = '1/0/1'
HL_smoothedData_errorType2_two$errorType2_num[HL_smoothedData_errorType2_two$errorType2 == 'onezerozero'] = '1/0/0'

HL_smoothedData_errorType2_two$errorType2_num[HL_smoothedData_errorType2_two$errorType2 == 'zerooneone'] = '0/1/1'
HL_smoothedData_errorType2_two$errorType2_num[HL_smoothedData_errorType2_two$errorType2 == 'zeroonezero'] = '0/1/0'
HL_smoothedData_errorType2_two$errorType2_num[HL_smoothedData_errorType2_two$errorType2 == 'zerozeroone'] = '0/0/1'
HL_smoothedData_errorType2_two$errorType2_num[HL_smoothedData_errorType2_two$errorType2 == 'zerozerozero'] = '0/0/0'
HL_smoothedData_errorType2_two$tp = as.numeric(HL_smoothedData_errorType2_two$tp)

# PLOT Experiment 5
HL_smoothedData_errorType2_two_plotting_trimmed = HL_smoothedData_errorType2_two %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorType2_two_plotting_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### zero #####
HL_smoothedData_errorType2_zero = data.frame(matrix(NA, ncol = 9,nrow = length(timepoints)*1))
colnames(HL_smoothedData_errorType2_zero) = c('tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

zeroData = compiledData_forced_trimmed %>% filter(expt == 'hierDyn',treeDistance == 0,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorType2_zero$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(zeroData$PT_actual > (timepoints[ti]-win) & zeroData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = zeroData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorType2 = HL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorType2_zero$zerozerozero[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/0']
      HL_smoothedData_errorType2_zero$zerozeroone[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/0/1']
      HL_smoothedData_errorType2_zero$zeroonezero[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/0']
      HL_smoothedData_errorType2_zero$zerooneone[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '0/1/1']
      
      HL_smoothedData_errorType2_zero$onezerozero[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/0']
      HL_smoothedData_errorType2_zero$onezeroone[ti]= HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/0/1']
      HL_smoothedData_errorType2_zero$oneonezero[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/0']
      HL_smoothedData_errorType2_zero$oneoneone[ti] = HL_relData_errorType2$prop[HL_relData_errorType2$errorType2 == '1/1/1']
      }
    }

HL_smoothedData_errorType2_zero = pivot_longer(HL_smoothedData_errorType2_zero, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
HL_smoothedData_errorType2_zero$errorType2 = as.factor(HL_smoothedData_errorType2_zero$errorType2)
HL_smoothedData_errorType2_zero$errorType2_num = NA
HL_smoothedData_errorType2_zero$errorType2_num[HL_smoothedData_errorType2_zero$errorType2 == 'oneoneone'] = '1/1/1'
HL_smoothedData_errorType2_zero$errorType2_num[HL_smoothedData_errorType2_zero$errorType2 == 'oneonezero'] = '1/1/0'
HL_smoothedData_errorType2_zero$errorType2_num[HL_smoothedData_errorType2_zero$errorType2 == 'onezeroone'] = '1/0/1'
HL_smoothedData_errorType2_zero$errorType2_num[HL_smoothedData_errorType2_zero$errorType2 == 'onezerozero'] = '1/0/0'

HL_smoothedData_errorType2_zero$errorType2_num[HL_smoothedData_errorType2_zero$errorType2 == 'zerooneone'] = '0/1/1'
HL_smoothedData_errorType2_zero$errorType2_num[HL_smoothedData_errorType2_zero$errorType2 == 'zeroonezero'] = '0/1/0'
HL_smoothedData_errorType2_zero$errorType2_num[HL_smoothedData_errorType2_zero$errorType2 == 'zerozeroone'] = '0/0/1'
HL_smoothedData_errorType2_zero$errorType2_num[HL_smoothedData_errorType2_zero$errorType2 == 'zerozerozero'] = '0/0/0'
HL_smoothedData_errorType2_zero$tp = as.numeric(HL_smoothedData_errorType2_zero$tp)

# PLOT Experiment 5
HL_smoothedData_errorType2_zero_plotting_trimmed = HL_smoothedData_errorType2_zero %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorType2_zero_plotting_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
```
# SUPER-SUBJECT: Experiment 5, P(response type) x PT (all 8 response types) x path distance
```{r, echo=F, message=F, warning=F, error=T, fig.width=4, fig.height=3, fig.align='center'}
minTime = min(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
maxTime = max(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
step = .01
win = .05
timepoints = seq(0,maxTime,step)

# flatDyn
#### SIX #####
FL_smoothedData_errorType2_six = data.frame(matrix(NA, ncol = 9,nrow = length(timepoints)*1))
colnames(FL_smoothedData_errorType2_six) = c('tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

sixData = compiledData_forced_trimmed %>% filter(expt == 'flatDyn',treeDistance == 6,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorType2_six$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(sixData$PT_actual > (timepoints[ti]-win) & sixData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = sixData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorType2 = FL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorType2_six$zerozerozero[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/0']
      FL_smoothedData_errorType2_six$zerozeroone[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/1']
      FL_smoothedData_errorType2_six$zeroonezero[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/0']
      FL_smoothedData_errorType2_six$zerooneone[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/1']
      
      FL_smoothedData_errorType2_six$onezerozero[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/0']
      FL_smoothedData_errorType2_six$onezeroone[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/1']
      FL_smoothedData_errorType2_six$oneonezero[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/0']
      FL_smoothedData_errorType2_six$oneoneone[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/1']
      }
    }

FL_smoothedData_errorType2_six = pivot_longer(FL_smoothedData_errorType2_six, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
FL_smoothedData_errorType2_six$errorType2 = as.factor(FL_smoothedData_errorType2_six$errorType2)
FL_smoothedData_errorType2_six$errorType2_num = NA
FL_smoothedData_errorType2_six$errorType2_num[FL_smoothedData_errorType2_six$errorType2 == 'oneoneone'] = '1/1/1'
FL_smoothedData_errorType2_six$errorType2_num[FL_smoothedData_errorType2_six$errorType2 == 'oneonezero'] = '1/1/0'
FL_smoothedData_errorType2_six$errorType2_num[FL_smoothedData_errorType2_six$errorType2 == 'onezeroone'] = '1/0/1'
FL_smoothedData_errorType2_six$errorType2_num[FL_smoothedData_errorType2_six$errorType2 == 'onezerozero'] = '1/0/0'

FL_smoothedData_errorType2_six$errorType2_num[FL_smoothedData_errorType2_six$errorType2 == 'zerooneone'] = '0/1/1'
FL_smoothedData_errorType2_six$errorType2_num[FL_smoothedData_errorType2_six$errorType2 == 'zeroonezero'] = '0/1/0'
FL_smoothedData_errorType2_six$errorType2_num[FL_smoothedData_errorType2_six$errorType2 == 'zerozeroone'] = '0/0/1'
FL_smoothedData_errorType2_six$errorType2_num[FL_smoothedData_errorType2_six$errorType2 == 'zerozerozero'] = '0/0/0'
FL_smoothedData_errorType2_six$tp = as.numeric(FL_smoothedData_errorType2_six$tp)

# PLOT Experiment 5
FL_smoothedData_errorType2_six_plotting_trimmed = FL_smoothedData_errorType2_six %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorType2_six_plotting_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### four #####
FL_smoothedData_errorType2_four = data.frame(matrix(NA, ncol = 9,nrow = length(timepoints)*1))
colnames(FL_smoothedData_errorType2_four) = c('tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

fourData = compiledData_forced_trimmed %>% filter(expt == 'flatDyn',treeDistance == 4,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorType2_four$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(fourData$PT_actual > (timepoints[ti]-win) & fourData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = fourData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorType2 = FL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorType2_four$zerozerozero[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/0']
      FL_smoothedData_errorType2_four$zerozeroone[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/1']
      FL_smoothedData_errorType2_four$zeroonezero[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/0']
      FL_smoothedData_errorType2_four$zerooneone[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/1']
      
      FL_smoothedData_errorType2_four$onezerozero[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/0']
      FL_smoothedData_errorType2_four$onezeroone[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/1']
      FL_smoothedData_errorType2_four$oneonezero[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/0']
      FL_smoothedData_errorType2_four$oneoneone[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/1']
      }
    }

FL_smoothedData_errorType2_four = pivot_longer(FL_smoothedData_errorType2_four, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
FL_smoothedData_errorType2_four$errorType2 = as.factor(FL_smoothedData_errorType2_four$errorType2)
FL_smoothedData_errorType2_four$errorType2_num = NA
FL_smoothedData_errorType2_four$errorType2_num[FL_smoothedData_errorType2_four$errorType2 == 'oneoneone'] = '1/1/1'
FL_smoothedData_errorType2_four$errorType2_num[FL_smoothedData_errorType2_four$errorType2 == 'oneonezero'] = '1/1/0'
FL_smoothedData_errorType2_four$errorType2_num[FL_smoothedData_errorType2_four$errorType2 == 'onezeroone'] = '1/0/1'
FL_smoothedData_errorType2_four$errorType2_num[FL_smoothedData_errorType2_four$errorType2 == 'onezerozero'] = '1/0/0'

FL_smoothedData_errorType2_four$errorType2_num[FL_smoothedData_errorType2_four$errorType2 == 'zerooneone'] = '0/1/1'
FL_smoothedData_errorType2_four$errorType2_num[FL_smoothedData_errorType2_four$errorType2 == 'zeroonezero'] = '0/1/0'
FL_smoothedData_errorType2_four$errorType2_num[FL_smoothedData_errorType2_four$errorType2 == 'zerozeroone'] = '0/0/1'
FL_smoothedData_errorType2_four$errorType2_num[FL_smoothedData_errorType2_four$errorType2 == 'zerozerozero'] = '0/0/0'
FL_smoothedData_errorType2_four$tp = as.numeric(FL_smoothedData_errorType2_four$tp)

# PLOT Experiment 5
FL_smoothedData_errorType2_four_plotting_trimmed = FL_smoothedData_errorType2_four %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorType2_four_plotting_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### two #####
FL_smoothedData_errorType2_two = data.frame(matrix(NA, ncol = 9,nrow = length(timepoints)*1))
colnames(FL_smoothedData_errorType2_two) = c('tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

twoData = compiledData_forced_trimmed %>% filter(expt == 'flatDyn',treeDistance == 2,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorType2_two$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(twoData$PT_actual > (timepoints[ti]-win) & twoData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = twoData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorType2 = FL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorType2_two$zerozerozero[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/0']
      FL_smoothedData_errorType2_two$zerozeroone[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/1']
      FL_smoothedData_errorType2_two$zeroonezero[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/0']
      FL_smoothedData_errorType2_two$zerooneone[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/1']
      
      FL_smoothedData_errorType2_two$onezerozero[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/0']
      FL_smoothedData_errorType2_two$onezeroone[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/1']
      FL_smoothedData_errorType2_two$oneonezero[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/0']
      FL_smoothedData_errorType2_two$oneoneone[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/1']
      }
    }

FL_smoothedData_errorType2_two = pivot_longer(FL_smoothedData_errorType2_two, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
FL_smoothedData_errorType2_two$errorType2 = as.factor(FL_smoothedData_errorType2_two$errorType2)
FL_smoothedData_errorType2_two$errorType2_num = NA
FL_smoothedData_errorType2_two$errorType2_num[FL_smoothedData_errorType2_two$errorType2 == 'oneoneone'] = '1/1/1'
FL_smoothedData_errorType2_two$errorType2_num[FL_smoothedData_errorType2_two$errorType2 == 'oneonezero'] = '1/1/0'
FL_smoothedData_errorType2_two$errorType2_num[FL_smoothedData_errorType2_two$errorType2 == 'onezeroone'] = '1/0/1'
FL_smoothedData_errorType2_two$errorType2_num[FL_smoothedData_errorType2_two$errorType2 == 'onezerozero'] = '1/0/0'

FL_smoothedData_errorType2_two$errorType2_num[FL_smoothedData_errorType2_two$errorType2 == 'zerooneone'] = '0/1/1'
FL_smoothedData_errorType2_two$errorType2_num[FL_smoothedData_errorType2_two$errorType2 == 'zeroonezero'] = '0/1/0'
FL_smoothedData_errorType2_two$errorType2_num[FL_smoothedData_errorType2_two$errorType2 == 'zerozeroone'] = '0/0/1'
FL_smoothedData_errorType2_two$errorType2_num[FL_smoothedData_errorType2_two$errorType2 == 'zerozerozero'] = '0/0/0'
FL_smoothedData_errorType2_two$tp = as.numeric(FL_smoothedData_errorType2_two$tp)

# PLOT Experiment 5
FL_smoothedData_errorType2_two_plotting_trimmed = FL_smoothedData_errorType2_two %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorType2_two_plotting_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### zero #####
FL_smoothedData_errorType2_zero = data.frame(matrix(NA, ncol = 9,nrow = length(timepoints)*1))
colnames(FL_smoothedData_errorType2_zero) = c('tp', 'oneoneone', 'oneonezero','onezeroone','onezerozero','zerooneone','zeroonezero','zerozeroone','zerozerozero')

zeroData = compiledData_forced_trimmed %>% filter(expt == 'flatDyn',treeDistance == 0,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorType2_zero$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(zeroData$PT_actual > (timepoints[ti]-win) & zeroData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = zeroData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorType2 = FL_relData %>% group_by(errorType2, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorType2_zero$zerozerozero[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/0']
      FL_smoothedData_errorType2_zero$zerozeroone[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/0/1']
      FL_smoothedData_errorType2_zero$zeroonezero[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/0']
      FL_smoothedData_errorType2_zero$zerooneone[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '0/1/1']
      
      FL_smoothedData_errorType2_zero$onezerozero[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/0']
      FL_smoothedData_errorType2_zero$onezeroone[ti]= FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/0/1']
      FL_smoothedData_errorType2_zero$oneonezero[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/0']
      FL_smoothedData_errorType2_zero$oneoneone[ti] = FL_relData_errorType2$prop[FL_relData_errorType2$errorType2 == '1/1/1']
      }
    }

FL_smoothedData_errorType2_zero = pivot_longer(FL_smoothedData_errorType2_zero, c(zerozerozero,zerozeroone,zeroonezero,zerooneone,onezerozero,onezeroone,oneonezero,oneoneone), names_to = 'errorType2', values_to = 'prop')
FL_smoothedData_errorType2_zero$errorType2 = as.factor(FL_smoothedData_errorType2_zero$errorType2)
FL_smoothedData_errorType2_zero$errorType2_num = NA
FL_smoothedData_errorType2_zero$errorType2_num[FL_smoothedData_errorType2_zero$errorType2 == 'oneoneone'] = '1/1/1'
FL_smoothedData_errorType2_zero$errorType2_num[FL_smoothedData_errorType2_zero$errorType2 == 'oneonezero'] = '1/1/0'
FL_smoothedData_errorType2_zero$errorType2_num[FL_smoothedData_errorType2_zero$errorType2 == 'onezeroone'] = '1/0/1'
FL_smoothedData_errorType2_zero$errorType2_num[FL_smoothedData_errorType2_zero$errorType2 == 'onezerozero'] = '1/0/0'

FL_smoothedData_errorType2_zero$errorType2_num[FL_smoothedData_errorType2_zero$errorType2 == 'zerooneone'] = '0/1/1'
FL_smoothedData_errorType2_zero$errorType2_num[FL_smoothedData_errorType2_zero$errorType2 == 'zeroonezero'] = '0/1/0'
FL_smoothedData_errorType2_zero$errorType2_num[FL_smoothedData_errorType2_zero$errorType2 == 'zerozeroone'] = '0/0/1'
FL_smoothedData_errorType2_zero$errorType2_num[FL_smoothedData_errorType2_zero$errorType2 == 'zerozerozero'] = '0/0/0'
FL_smoothedData_errorType2_zero$tp = as.numeric(FL_smoothedData_errorType2_zero$tp)

# PLOT Experiment 5
FL_smoothedData_errorType2_zero_plotting_trimmed = FL_smoothedData_errorType2_zero %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorType2_zero_plotting_trimmed, aes(x =tp,y = prop, group = errorType2_num,color = errorType2_num)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
```
# SUPER-SUBJECT: Experiment 5, P(response type) ERRORLEVEL x PT x path distance
```{r, echo=F, message=F, warning=F, error=T, fig.width=4, fig.height=3, fig.align='center'}
minTime = min(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
maxTime = max(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
step = .01
win = .05
timepoints = seq(0,maxTime,step)

# HIERDYN
#### SIX #####
HL_smoothedData_errorLevel_six = data.frame(matrix(NA, ncol = 5,nrow = length(timepoints)*1))
colnames(HL_smoothedData_errorLevel_six) = c('tp', 'acorr', 'bbottom','cmid','dtop')

sixData = compiledData_forced_trimmed %>% filter(expt == 'hierDyn',treeDistance_stim == 6,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorLevel_six$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(sixData$PT_actual > (timepoints[ti]-win) & sixData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = sixData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorLevel = HL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorLevel_six$acorr[ti] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'acorr']
      HL_smoothedData_errorLevel_six$bbottom[ti] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'bbottom']
      HL_smoothedData_errorLevel_six$cmid[ti]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'cmid']
      HL_smoothedData_errorLevel_six$dtop[ti]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'dtop']

      }
    }

HL_smoothedData_errorLevel_six = pivot_longer(HL_smoothedData_errorLevel_six, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
HL_smoothedData_errorLevel_six$prop_corrected = HL_smoothedData_errorLevel_six$prop
HL_smoothedData_errorLevel_six$prop_corrected[HL_smoothedData_errorLevel_six$errorLevel == 'dtop'] = HL_smoothedData_errorLevel_six$prop_corrected[HL_smoothedData_errorLevel_six$errorLevel == 'dtop']/4
HL_smoothedData_errorLevel_six$prop_corrected[HL_smoothedData_errorLevel_six$errorLevel == 'cmid'] = HL_smoothedData_errorLevel_six$prop_corrected[HL_smoothedData_errorLevel_six$errorLevel == 'cmid']/2

HL_smoothedData_errorLevel_six$tp = as.numeric(HL_smoothedData_errorLevel_six$tp)

# PLOT Experiment 5
HL_smoothedData_errorLevel_six_plotting_trimmed = HL_smoothedData_errorLevel_six %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorLevel_six_plotting_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('hd_six_errorlevelxPT.eps')
#### four #####
HL_smoothedData_errorLevel_four = data.frame(matrix(NA, ncol = 5,nrow = length(timepoints)*1))
colnames(HL_smoothedData_errorLevel_four) = c('tp', 'acorr', 'bbottom','cmid','dtop')

fourData = compiledData_forced_trimmed %>% filter(expt == 'hierDyn',treeDistance_stim == 4,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorLevel_four$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(fourData$PT_actual > (timepoints[ti]-win) & fourData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = fourData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorLevel = HL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorLevel_four$acorr[ti] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'acorr']
      HL_smoothedData_errorLevel_four$bbottom[ti] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'bbottom']
      HL_smoothedData_errorLevel_four$cmid[ti]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'cmid']
      HL_smoothedData_errorLevel_four$dtop[ti]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'dtop']

      }
    }

HL_smoothedData_errorLevel_four = pivot_longer(HL_smoothedData_errorLevel_four, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
HL_smoothedData_errorLevel_four$prop_corrected = HL_smoothedData_errorLevel_four$prop
HL_smoothedData_errorLevel_four$prop_corrected[HL_smoothedData_errorLevel_four$errorLevel == 'dtop'] = HL_smoothedData_errorLevel_four$prop_corrected[HL_smoothedData_errorLevel_four$errorLevel == 'dtop']/4
HL_smoothedData_errorLevel_four$prop_corrected[HL_smoothedData_errorLevel_four$errorLevel == 'cmid'] = HL_smoothedData_errorLevel_four$prop_corrected[HL_smoothedData_errorLevel_four$errorLevel == 'cmid']/2

HL_smoothedData_errorLevel_four$tp = as.numeric(HL_smoothedData_errorLevel_four$tp)

# PLOT Experiment 5
HL_smoothedData_errorLevel_four_plotting_trimmed = HL_smoothedData_errorLevel_four %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorLevel_four_plotting_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('hd_four_errorlevelxPT.eps')

#### two #####
HL_smoothedData_errorLevel_two = data.frame(matrix(NA, ncol = 5,nrow = length(timepoints)*1))
colnames(HL_smoothedData_errorLevel_two) = c('tp', 'acorr', 'bbottom','cmid','dtop')

twoData = compiledData_forced_trimmed %>% filter(expt == 'hierDyn',treeDistance_stim == 2,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorLevel_two$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(twoData$PT_actual > (timepoints[ti]-win) & twoData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = twoData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorLevel = HL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorLevel_two$acorr[ti] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'acorr']
      HL_smoothedData_errorLevel_two$bbottom[ti] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'bbottom']
      HL_smoothedData_errorLevel_two$cmid[ti]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'cmid']
      HL_smoothedData_errorLevel_two$dtop[ti]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'dtop']

      }
    }

HL_smoothedData_errorLevel_two = pivot_longer(HL_smoothedData_errorLevel_two, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
HL_smoothedData_errorLevel_two$prop_corrected = HL_smoothedData_errorLevel_two$prop
HL_smoothedData_errorLevel_two$prop_corrected[HL_smoothedData_errorLevel_two$errorLevel == 'dtop'] = HL_smoothedData_errorLevel_two$prop_corrected[HL_smoothedData_errorLevel_two$errorLevel == 'dtop']/4
HL_smoothedData_errorLevel_two$prop_corrected[HL_smoothedData_errorLevel_two$errorLevel == 'cmid'] = HL_smoothedData_errorLevel_two$prop_corrected[HL_smoothedData_errorLevel_two$errorLevel == 'cmid']/2

HL_smoothedData_errorLevel_two$tp = as.numeric(HL_smoothedData_errorLevel_two$tp)

# PLOT Experiment 5
HL_smoothedData_errorLevel_two_plotting_trimmed = HL_smoothedData_errorLevel_two %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorLevel_two_plotting_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('hd_two_errorlevelxPT.eps')

#### zero #####
HL_smoothedData_errorLevel_zero = data.frame(matrix(NA, ncol = 5,nrow = length(timepoints)*1))
colnames(HL_smoothedData_errorLevel_zero) = c('tp', 'acorr', 'bbottom','cmid','dtop')

zeroData = compiledData_forced_trimmed %>% filter(expt == 'hierDyn',treeDistance_stim == 0,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    HL_smoothedData_errorLevel_zero$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(zeroData$PT_actual > (timepoints[ti]-win) & zeroData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      HL_relData = zeroData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      HL_relData_errorLevel = HL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      HL_smoothedData_errorLevel_zero$acorr[ti] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'acorr']
      HL_smoothedData_errorLevel_zero$bbottom[ti] = HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'bbottom']
      HL_smoothedData_errorLevel_zero$cmid[ti]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'cmid']
      HL_smoothedData_errorLevel_zero$dtop[ti]= HL_relData_errorLevel$prop[HL_relData_errorLevel$errorLevel == 'dtop']

      }
    }

HL_smoothedData_errorLevel_zero = pivot_longer(HL_smoothedData_errorLevel_zero, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
HL_smoothedData_errorLevel_zero$prop_corrected = HL_smoothedData_errorLevel_zero$prop
HL_smoothedData_errorLevel_zero$prop_corrected[HL_smoothedData_errorLevel_zero$errorLevel == 'dtop'] = HL_smoothedData_errorLevel_zero$prop_corrected[HL_smoothedData_errorLevel_zero$errorLevel == 'dtop']/4
HL_smoothedData_errorLevel_zero$prop_corrected[HL_smoothedData_errorLevel_zero$errorLevel == 'cmid'] = HL_smoothedData_errorLevel_zero$prop_corrected[HL_smoothedData_errorLevel_zero$errorLevel == 'cmid']/2

HL_smoothedData_errorLevel_zero$tp = as.numeric(HL_smoothedData_errorLevel_zero$tp)

# PLOT Experiment 5
HL_smoothedData_errorLevel_zero_plotting_trimmed = HL_smoothedData_errorLevel_zero %>% filter(tp %in% seq(.1,1.2,step))
ggplot(HL_smoothedData_errorLevel_zero_plotting_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
#ggsave('hd_zero_errorlevelxPT.eps')

```
# SUPER-SUBJECT: Experiment 5, P(response type) x PT (all 8 response types) x path distance
```{r, echo=F, message=F, warning=F, error=T, fig.width=4, fig.height=3, fig.align='center'}
minTime = min(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
maxTime = max(compiledData_forced_trimmed$PT_actual,na.rm = TRUE)
step = .01
win = .05
timepoints = seq(0,maxTime,step)

# flatDyn
#### SIX #####
FL_smoothedData_errorLevel_six = data.frame(matrix(NA, ncol = 5,nrow = length(timepoints)*1))
colnames(FL_smoothedData_errorLevel_six) = c('tp', 'acorr', 'bbottom','cmid','dtop')

sixData = compiledData_forced_trimmed %>% filter(expt == 'flatDyn',treeDistance_stim == 6,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorLevel_six$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(sixData$PT_actual > (timepoints[ti]-win) & sixData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = sixData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorLevel = FL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorLevel_six$acorr[ti] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'acorr']
      FL_smoothedData_errorLevel_six$bbottom[ti] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'bbottom']
      FL_smoothedData_errorLevel_six$cmid[ti]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'cmid']
      FL_smoothedData_errorLevel_six$dtop[ti]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'dtop']

      }
    }

FL_smoothedData_errorLevel_six = pivot_longer(FL_smoothedData_errorLevel_six, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
FL_smoothedData_errorLevel_six$prop_corrected = FL_smoothedData_errorLevel_six$prop
FL_smoothedData_errorLevel_six$prop_corrected[FL_smoothedData_errorLevel_six$errorLevel == 'dtop'] = FL_smoothedData_errorLevel_six$prop_corrected[FL_smoothedData_errorLevel_six$errorLevel == 'dtop']/4
FL_smoothedData_errorLevel_six$prop_corrected[FL_smoothedData_errorLevel_six$errorLevel == 'cmid'] = FL_smoothedData_errorLevel_six$prop_corrected[FL_smoothedData_errorLevel_six$errorLevel == 'cmid']/2

FL_smoothedData_errorLevel_six$tp = as.numeric(FL_smoothedData_errorLevel_six$tp)

# PLOT Experiment 5
FL_smoothedData_errorLevel_six_plotting_trimmed = FL_smoothedData_errorLevel_six %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorLevel_six_plotting_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### four #####
FL_smoothedData_errorLevel_four = data.frame(matrix(NA, ncol = 5,nrow = length(timepoints)*1))
colnames(FL_smoothedData_errorLevel_four) = c('tp', 'acorr', 'bbottom','cmid','dtop')

fourData = compiledData_forced_trimmed %>% filter(expt == 'flatDyn',treeDistance_stim == 4,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorLevel_four$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(fourData$PT_actual > (timepoints[ti]-win) & fourData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = fourData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorLevel = FL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorLevel_four$acorr[ti] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'acorr']
      FL_smoothedData_errorLevel_four$bbottom[ti] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'bbottom']
      FL_smoothedData_errorLevel_four$cmid[ti]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'cmid']
      FL_smoothedData_errorLevel_four$dtop[ti]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'dtop']

      }
    }

FL_smoothedData_errorLevel_four = pivot_longer(FL_smoothedData_errorLevel_four, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
FL_smoothedData_errorLevel_four$prop_corrected = FL_smoothedData_errorLevel_four$prop
FL_smoothedData_errorLevel_four$prop_corrected[FL_smoothedData_errorLevel_four$errorLevel == 'dtop'] = FL_smoothedData_errorLevel_four$prop_corrected[FL_smoothedData_errorLevel_four$errorLevel == 'dtop']/4
FL_smoothedData_errorLevel_four$prop_corrected[FL_smoothedData_errorLevel_four$errorLevel == 'cmid'] = FL_smoothedData_errorLevel_four$prop_corrected[FL_smoothedData_errorLevel_four$errorLevel == 'cmid']/2

FL_smoothedData_errorLevel_four$tp = as.numeric(FL_smoothedData_errorLevel_four$tp)

# PLOT Experiment 5
FL_smoothedData_errorLevel_four_plotting_trimmed = FL_smoothedData_errorLevel_four %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorLevel_four_plotting_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### two #####
FL_smoothedData_errorLevel_two = data.frame(matrix(NA, ncol = 5,nrow = length(timepoints)*1))
colnames(FL_smoothedData_errorLevel_two) = c('tp', 'acorr', 'bbottom','cmid','dtop')

twoData = compiledData_forced_trimmed %>% filter(expt == 'flatDyn',treeDistance_stim == 2,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorLevel_two$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(twoData$PT_actual > (timepoints[ti]-win) & twoData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = twoData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorLevel = FL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorLevel_two$acorr[ti] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'acorr']
      FL_smoothedData_errorLevel_two$bbottom[ti] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'bbottom']
      FL_smoothedData_errorLevel_two$cmid[ti]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'cmid']
      FL_smoothedData_errorLevel_two$dtop[ti]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'dtop']

      }
    }

FL_smoothedData_errorLevel_two = pivot_longer(FL_smoothedData_errorLevel_two, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
FL_smoothedData_errorLevel_two$prop_corrected = FL_smoothedData_errorLevel_two$prop
FL_smoothedData_errorLevel_two$prop_corrected[FL_smoothedData_errorLevel_two$errorLevel == 'dtop'] = FL_smoothedData_errorLevel_two$prop_corrected[FL_smoothedData_errorLevel_two$errorLevel == 'dtop']/4
FL_smoothedData_errorLevel_two$prop_corrected[FL_smoothedData_errorLevel_two$errorLevel == 'cmid'] = FL_smoothedData_errorLevel_two$prop_corrected[FL_smoothedData_errorLevel_two$errorLevel == 'cmid']/2

FL_smoothedData_errorLevel_two$tp = as.numeric(FL_smoothedData_errorLevel_two$tp)

# PLOT Experiment 5
FL_smoothedData_errorLevel_two_plotting_trimmed = FL_smoothedData_errorLevel_two %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorLevel_two_plotting_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

#### zero #####
FL_smoothedData_errorLevel_zero = data.frame(matrix(NA, ncol = 5,nrow = length(timepoints)*1))
colnames(FL_smoothedData_errorLevel_zero) = c('tp', 'acorr', 'bbottom','cmid','dtop')

zeroData = compiledData_forced_trimmed %>% filter(expt == 'flatDyn',treeDistance_stim == 0,timing == 1)
  for(ti in 1:length(timepoints)){
    #fill in data for first two columns (regardless of whether we actually end up having data there)
    FL_smoothedData_errorLevel_zero$tp[ti] = timepoints[ti]
    # get the indices of PT within the window
    idx = which(zeroData$PT_actual > (timepoints[ti]-win) & zeroData$PT_actual < (timepoints[ti] + win))
    if(length(idx > 0)){
      # filter to dataframe with just data with PT in the window
      FL_relData = zeroData %>% filter(row_number() %in% idx)
      # group dataframe and get proportions
      FL_relData_errorLevel = FL_relData %>% group_by(errorLevel, .drop = FALSE) %>% dplyr::summarize(counts = n()) %>% dplyr::mutate(prop = counts/sum(counts))
      FL_smoothedData_errorLevel_zero$acorr[ti] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'acorr']
      FL_smoothedData_errorLevel_zero$bbottom[ti] = FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'bbottom']
      FL_smoothedData_errorLevel_zero$cmid[ti]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'cmid']
      FL_smoothedData_errorLevel_zero$dtop[ti]= FL_relData_errorLevel$prop[FL_relData_errorLevel$errorLevel == 'dtop']

      }
    }

FL_smoothedData_errorLevel_zero = pivot_longer(FL_smoothedData_errorLevel_zero, c(acorr,bbottom,cmid,dtop), names_to = 'errorLevel', values_to = 'prop')
FL_smoothedData_errorLevel_zero$prop_corrected = FL_smoothedData_errorLevel_zero$prop
FL_smoothedData_errorLevel_zero$prop_corrected[FL_smoothedData_errorLevel_zero$errorLevel == 'dtop'] = FL_smoothedData_errorLevel_zero$prop_corrected[FL_smoothedData_errorLevel_zero$errorLevel == 'dtop']/4
FL_smoothedData_errorLevel_zero$prop_corrected[FL_smoothedData_errorLevel_zero$errorLevel == 'cmid'] = FL_smoothedData_errorLevel_zero$prop_corrected[FL_smoothedData_errorLevel_zero$errorLevel == 'cmid']/2

FL_smoothedData_errorLevel_zero$tp = as.numeric(FL_smoothedData_errorLevel_zero$tp)

# PLOT Experiment 5
FL_smoothedData_errorLevel_zero_plotting_trimmed = FL_smoothedData_errorLevel_zero %>% filter(tp %in% seq(.1,1.2,step))
ggplot(FL_smoothedData_errorLevel_zero_plotting_trimmed, aes(x =tp,y = prop_corrected, group = errorLevel,color = errorLevel)) + geom_line()+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))
```

# p(errorLevel) bar graphs by distance
```{r, echo=F, message=F, warning=F, error=T,fig.width=6, fig.height=4, fig.align='center'}
countsBySub = compiledData_forced_trimmed %>% group_by(expt,subject,treeDistance_stim) %>% filter(timing == 1) %>% dplyr::summarise(counts = n())
ggplot(countsBySub, aes(x = treeDistance_stim, y = counts))+geom_bar(stat = 'summary', fun.y = 'mean')+geom_point()+facet_wrap(~expt)

errorLevelxeml2xtree_six = compiledData_forced_trimmed %>% filter(treeDistance_stim == 6, timing == 1) %>% group_by(expt, subject, eml2,errorLevel) %>% dplyr::summarise(counts = n()) %>% group_by(expt, subject, eml2) %>% mutate(prop = counts/sum(counts)) %>% filter(errorLevel != 'acorr')
errorLevelxeml2xtree_six$prop_corrected = errorLevelxeml2xtree_six$prop
errorLevelxeml2xtree_six$prop_corrected[errorLevelxeml2xtree_six$errorLevel == 'dtop'] = errorLevelxeml2xtree_six$prop_corrected[errorLevelxeml2xtree_six$errorLevel == 'dtop']/4
errorLevelxeml2xtree_six$prop_corrected[errorLevelxeml2xtree_six$errorLevel == 'cmid'] = errorLevelxeml2xtree_six$prop_corrected[errorLevelxeml2xtree_six$errorLevel == 'cmid']/2
errorLevelxeml2xtree_six_summary = summarySEwithin(errorLevelxeml2xtree_six, measurevar = 'prop_corrected',withinvars = c('errorLevel', 'eml2'), betweenvars = 'expt',idvar = 'subject', na.rm = TRUE)
ggplot(errorLevelxeml2xtree_six_summary, aes(x = errorLevel, y = prop_corrected))+geom_bar(stat = 'summary', fun.y = 'mean')+geom_errorbar(aes(ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+geom_point()+facet_wrap(~expt+eml2)

errorLevelxeml2xtree_four = compiledData_forced_trimmed %>% filter(treeDistance_stim == 4, timing == 1) %>% group_by(expt, subject, eml2,errorLevel) %>% dplyr::summarise(counts = n()) %>% group_by(expt, subject, eml2) %>% mutate(prop = counts/sum(counts)) %>% filter(errorLevel != 'acorr')
errorLevelxeml2xtree_four$prop_corrected = errorLevelxeml2xtree_four$prop
errorLevelxeml2xtree_four$prop_corrected[errorLevelxeml2xtree_four$errorLevel == 'dtop'] = errorLevelxeml2xtree_four$prop_corrected[errorLevelxeml2xtree_four$errorLevel == 'dtop']/4
errorLevelxeml2xtree_four$prop_corrected[errorLevelxeml2xtree_four$errorLevel == 'cmid'] = errorLevelxeml2xtree_four$prop_corrected[errorLevelxeml2xtree_four$errorLevel == 'cmid']/2
errorLevelxeml2xtree_four_summary = summarySEwithin(errorLevelxeml2xtree_four, measurevar = 'prop_corrected',withinvars = c('errorLevel', 'eml2'), betweenvars = 'expt',idvar = 'subject', na.rm = TRUE)
ggplot(errorLevelxeml2xtree_four_summary, aes(x = errorLevel, y = prop_corrected))+geom_bar(stat = 'summary', fun.y = 'mean')+geom_errorbar(aes(ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+geom_point()+facet_wrap(~expt+eml2)

errorLevelxeml2xtree_two = compiledData_forced_trimmed %>% filter(treeDistance_stim == 2, timing == 1) %>% group_by(expt, subject, eml2,errorLevel) %>% dplyr::summarise(counts = n()) %>% group_by(expt, subject, eml2) %>% mutate(prop = counts/sum(counts)) %>% filter(errorLevel != 'acorr')
errorLevelxeml2xtree_two$prop_corrected = errorLevelxeml2xtree_two$prop
errorLevelxeml2xtree_two$prop_corrected[errorLevelxeml2xtree_two$errorLevel == 'dtop'] = errorLevelxeml2xtree_two$prop_corrected[errorLevelxeml2xtree_two$errorLevel == 'dtop']/4
errorLevelxeml2xtree_two$prop_corrected[errorLevelxeml2xtree_two$errorLevel == 'cmid'] = errorLevelxeml2xtree_two$prop_corrected[errorLevelxeml2xtree_two$errorLevel == 'cmid']/2
errorLevelxeml2xtree_two_summary = summarySEwithin(errorLevelxeml2xtree_two, measurevar = 'prop_corrected',withinvars = c('errorLevel', 'eml2'), betweenvars = 'expt',idvar = 'subject', na.rm = TRUE)
ggplot(errorLevelxeml2xtree_two_summary, aes(x = errorLevel, y = prop_corrected))+geom_bar(stat = 'summary', fun.y = 'mean')+geom_errorbar(aes(ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+geom_point()+facet_wrap(~expt+eml2)

errorLevelxeml2xtree_zero = compiledData_forced_trimmed %>% filter(treeDistance_stim == 0, timing == 1) %>% group_by(expt, subject, eml2,errorLevel) %>% dplyr::summarise(counts = n()) %>% group_by(expt, subject, eml2) %>% mutate(prop = counts/sum(counts)) %>% filter(errorLevel != 'acorr')
errorLevelxeml2xtree_zero$prop_corrected = errorLevelxeml2xtree_zero$prop
errorLevelxeml2xtree_zero$prop_corrected[errorLevelxeml2xtree_zero$errorLevel == 'dtop'] = errorLevelxeml2xtree_zero$prop_corrected[errorLevelxeml2xtree_zero$errorLevel == 'dtop']/4
errorLevelxeml2xtree_zero$prop_corrected[errorLevelxeml2xtree_zero$errorLevel == 'cmid'] = errorLevelxeml2xtree_zero$prop_corrected[errorLevelxeml2xtree_zero$errorLevel == 'cmid']/2
errorLevelxeml2xtree_zero_summary = summarySEwithin(errorLevelxeml2xtree_zero, measurevar = 'prop_corrected',withinvars = c('errorLevel', 'eml2'), betweenvars = 'expt',idvar = 'subject', na.rm = TRUE)
ggplot(errorLevelxeml2xtree_zero_summary, aes(x = errorLevel, y = prop_corrected))+geom_bar(stat = 'summary', fun.y = 'mean')+geom_errorbar(aes(ymin = prop_corrected-se, ymax = prop_corrected+se), width = .2)+geom_point()+facet_wrap(~expt+eml2)

```
# Super-subject bar graphs by distance
```{r, echo=F, message=F, warning=F, error=T,fig.width=6, fig.height=4, fig.align='center'}
errorLevelxeml2xtree_super_six = compiledData_forced_trimmed %>% filter(treeDistance_stim == 6, timing == 1) %>% group_by(expt, eml2,errorLevel) %>% dplyr::summarise(counts = n()) %>% group_by(expt, eml2) %>% mutate(prop = counts/sum(counts)) %>% filter(errorLevel != 'acorr')
errorLevelxeml2xtree_super_six$prop_corrected = errorLevelxeml2xtree_super_six$prop
errorLevelxeml2xtree_super_six$prop_corrected[errorLevelxeml2xtree_super_six$errorLevel == 'dtop'] = errorLevelxeml2xtree_super_six$prop_corrected[errorLevelxeml2xtree_super_six$errorLevel == 'dtop']/4
errorLevelxeml2xtree_super_six$prop_corrected[errorLevelxeml2xtree_super_six$errorLevel == 'cmid'] = errorLevelxeml2xtree_super_six$prop_corrected[errorLevelxeml2xtree_super_six$errorLevel == 'cmid']/2
ggplot(errorLevelxeml2xtree_super_six, aes(x = errorLevel, y = prop_corrected))+geom_bar(stat = 'identity')+geom_point()+facet_wrap(~expt+eml2)

errorLevelxeml2xtree_super_four = compiledData_forced_trimmed %>% filter(treeDistance_stim == 4, timing == 1) %>% group_by(expt,eml2,errorLevel) %>% dplyr::summarise(counts = n()) %>% group_by(expt, eml2) %>% mutate(prop = counts/sum(counts)) %>% filter(errorLevel != 'acorr')
errorLevelxeml2xtree_super_four$prop_corrected = errorLevelxeml2xtree_super_four$prop
errorLevelxeml2xtree_super_four$prop_corrected[errorLevelxeml2xtree_super_four$errorLevel == 'dtop'] = errorLevelxeml2xtree_super_four$prop_corrected[errorLevelxeml2xtree_super_four$errorLevel == 'dtop']/4
errorLevelxeml2xtree_super_four$prop_corrected[errorLevelxeml2xtree_super_four$errorLevel == 'cmid'] = errorLevelxeml2xtree_super_four$prop_corrected[errorLevelxeml2xtree_super_four$errorLevel == 'cmid']/2
ggplot(errorLevelxeml2xtree_super_four, aes(x = errorLevel, y = prop_corrected))+geom_bar(stat = 'identity')+geom_point()+facet_wrap(~expt+eml2)

errorLevelxeml2xtree_super_two = compiledData_forced_trimmed %>% filter(treeDistance_stim == 2, timing == 1) %>% group_by(expt,eml2,errorLevel) %>% dplyr::summarise(counts = n()) %>% group_by(expt, eml2) %>% mutate(prop = counts/sum(counts)) %>% filter(errorLevel != 'acorr')
errorLevelxeml2xtree_super_two$prop_corrected = errorLevelxeml2xtree_super_two$prop
errorLevelxeml2xtree_super_two$prop_corrected[errorLevelxeml2xtree_super_two$errorLevel == 'dtop'] = errorLevelxeml2xtree_super_two$prop_corrected[errorLevelxeml2xtree_super_two$errorLevel == 'dtop']/4
errorLevelxeml2xtree_super_two$prop_corrected[errorLevelxeml2xtree_super_two$errorLevel == 'cmid'] = errorLevelxeml2xtree_super_two$prop_corrected[errorLevelxeml2xtree_super_two$errorLevel == 'cmid']/2
ggplot(errorLevelxeml2xtree_super_two, aes(x = errorLevel, y = prop_corrected))+geom_bar(stat = 'identity')+geom_point()+facet_wrap(~expt+eml2)

errorLevelxeml2xtree_super_zero = compiledData_forced_trimmed %>% filter(treeDistance_stim == 0, timing == 1) %>% group_by(expt, eml2,errorLevel) %>% dplyr::summarise(counts = n()) %>% group_by(expt, eml2) %>% mutate(prop = counts/sum(counts)) %>% filter(errorLevel != 'acorr')
errorLevelxeml2xtree_super_zero$prop_corrected = errorLevelxeml2xtree_super_zero$prop
errorLevelxeml2xtree_super_zero$prop_corrected[errorLevelxeml2xtree_super_zero$errorLevel == 'dtop'] = errorLevelxeml2xtree_super_zero$prop_corrected[errorLevelxeml2xtree_super_zero$errorLevel == 'dtop']/4
errorLevelxeml2xtree_super_zero$prop_corrected[errorLevelxeml2xtree_super_zero$errorLevel == 'cmid'] = errorLevelxeml2xtree_super_zero$prop_corrected[errorLevelxeml2xtree_super_zero$errorLevel == 'cmid']/2
ggplot(errorLevelxeml2xtree_super_zero, aes(x = errorLevel, y = prop_corrected))+geom_bar(stat = 'identity')+geom_point()+facet_wrap(~expt+eml2)

```

\newpage
# Simulation plots for Experiment 6 (best fitting model = flat)
```{r, echo=F, message=F, warning=F, error=T,fig.width=6, fig.height=4, fig.align='center'}
# SET UP SIMULATION DATA
  flat_simData_par_type = read_csv(file = 'simulations/Experiment6_nostructure_type_simdata.csv')
  
  step = .001
  timepoints = seq(0,1.2,step)
  
  flat_simData_par_type$tp = timepoints
  
 flat_simData_par_type_long = flat_simData_par_type %>% pivot_longer(cols = c('corr','low','mid','top'), names_to = 'type', values_to = 'prop')

ggplot(flat_simData_par_type_long, aes(x =tp,y = prop, group = type,color = type)) + geom_line()+scale_x_continuous(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2))+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm")) 

```
# Simulations for Experiment 5 (best fitting model = hierarchical)
```{r, echo=F, message=F, warning=F, error=T,fig.width=6, fig.height=4, fig.align='center'}
# SET UP SIMULATION DATA
  simData_par_type = read_csv(file = 'simulations/Experiment5_hier_simdata.csv') # Hierarchical 1-sigma model
  simData_par_sig_type = read_csv(file = 'simulations/Experiment5_sigmaall_type_simdata.csv') # Hierarchical 3-sigma model
  step = .001
  timepoints = seq(0,1.5,step)
  
  simData_par_type$tp =timepoints
  simData_par_sig_type$tp = timepoints

  simData_par_type_long = simData_par_type %>% pivot_longer(cols = c('corr','low','mid','top'), names_to = 'type', values_to = 'prop')
  simData_par_sig_type_long = simData_par_sig_type %>% pivot_longer(cols = c('corr','low','mid','top'), names_to = 'type', values_to = 'prop')


ggplot(simData_par_type_long, aes(x =tp,y = prop, group = type,color = type)) + geom_line()+scale_x_continuous(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4))+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

ggplot(simData_par_sig_type_long, aes(x =tp,y = prop, group = type,color = type)) + geom_line()+scale_x_continuous(name = 'prep time', breaks = c(0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4))+scale_y_continuous(expand = c(0,0),limits = c(0,1), breaks = c(0,.2,.4,.6,.8,1))+
  theme(axis.line=element_line(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "white", colour = "black")
        ,panel.border = element_rect(fill = NA, colour = "white"),
        strip.text = element_text(size=axisTitleSize,face="bold"), 
        axis.title.x = element_text(size = axisTitleSize, face = 'bold'), 
        axis.title.y = element_text(size = axisTitleSize, face = 'bold'), 
        axis.text.x = element_text(size = axisTextSize), 
        axis.text.y = element_text(size = axisTextSize), 
        legend.position = "right", 
        legend.title = element_blank(),
        legend.text = element_text(size = axisTextSize),
        axis.line.x.bottom=element_line(size=axisWidth), 
        axis.line.y.left=element_line(size=axisWidth), 
        axis.ticks = element_line(colour = axisColor, size = tickWidth), 
        axis.ticks.length = unit(tickLength,"cm"))

```
